<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô V23+ (‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô + ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô .txt)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap');
    body{
      font-family:'Sarabun',sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 25%,#f093fb 50%,#f5576c 75%,#4facfe 100%);
      background-size:400% 400%;
      animation:gradientShift 15s ease infinite;
      min-height:100vh
    }
    @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .glass{backdrop-filter:blur(16px);background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.28)}
    .neon{position:relative;overflow:hidden;transition:transform .2s ease,box-shadow .2s ease}
    .neon:hover{transform:translateY(-2px);box-shadow:0 12px 28px rgba(0,0,0,.18)}
    .calendar-day{transition:all .15s ease}
    .badge{border-radius:999px;padding:.25rem .6rem;font-weight:700;font-size:.75rem}
    .status-work{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}
    .status-paid{background:linear-gradient(135deg,#f59e0b,#f97316);color:#fff}
    .status-absent{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}
    .today{outline:3px solid #fb7185;box-shadow:0 0 12px rgba(251,113,133,.6)}
    .legend-dot{width:14px;height:14px;border-radius:4px}
    .dot-work{background:linear-gradient(135deg,#22c55e,#16a34a)}
    .dot-paid{background:linear-gradient(135deg,#f59e0b,#f97316)}
    .dot-absent{background:linear-gradient(135deg,#ef4444,#dc2626)}
    .dot-none{background:#e5e7eb}
    .switch{position:relative;display:inline-block;width:56px;height:30px}
    .switch input{opacity:0;width:0;height:0}
    .slider{position:absolute;cursor:pointer;inset:0;background:#e5e7eb;transition:.2s;border-radius:999px}
    .slider:before{position:absolute;content:"";height:22px;width:22px;left:4px;top:4px;background:white;transition:.2s;border-radius:50%}
    input:checked + .slider{background:#22c55e}
    input:checked + .slider:before{transform:translateX(26px)}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:50}
    .modal.show{display:flex}
  </style>
</head>
<body class="text-gray-800">
  <div class="max-w-7xl mx-auto px-4 py-10">
    <div class="text-center mb-10">
      <h1 class="text-4xl md:text-5xl font-extrabold text-white drop-shadow-lg">üíº ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô V23+</h1>
      <p class="text-white/90 mt-3 text-lg">‡∏•‡πá‡∏≠‡∏Ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç, ‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏ß‡∏±‡∏ô, ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô/‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô .txt</p>
    </div>

    <!-- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div class="glass rounded-2xl p-6 md:p-8 mb-8">
      <div class="flex items-center mb-6">
        <div class="p-3 rounded-full bg-gradient-to-r from-emerald-400 to-teal-500 mr-3">
          <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 7h18M3 12h18M3 17h18"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
      </div>

      <div class="grid md:grid-cols-2 gap-4 mb-6">
        <button id="addEmployeeBtn" class="neon bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-600 hover:from-pink-600 hover:via-purple-600 hover:to-indigo-700 text-white px-6 py-4 rounded-xl font-bold">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
        <button id="editEmployeeBtn" class="neon bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-600 hover:from-cyan-600 hover:via-blue-600 hover:to-purple-700 text-white px-6 py-4 rounded-xl font-bold">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
        <select id="employeeSelect" class="w-full p-4 rounded-xl border-2 border-white/60 bg-white/80 focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400">
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</option>
        </select>
      </div>

      <!-- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets -->
      <div class="mt-6 p-5 bg-white/75 rounded-xl border">
        <div class="flex items-center mb-4">
          <div class="p-2 rounded-full bg-gradient-to-r from-green-400 to-blue-500 mr-3">
            <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h3 class="text-lg font-bold">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
        </div>
        <label class="block text-sm font-semibold mb-2">‡∏•‡∏¥‡∏á‡∏Å‡πå Google Apps Script (Web App URL)</label>
        <input type="text" id="appsScriptUrl" value="https://script.google.com/macros/s/AKfycbx007JciE0VKzKRR2W1Ho_vDkvHoW_JNSGQHAiUNRe7UMJtjO5_zG6l7W0FXINAa_H9MA/exec" placeholder="" class="w-full p-3 rounded-xl border-2 mb-3"/>
        <div class="flex flex-col sm:flex-row gap-3">
          <button id="loadFromSheets" class="neon bg-gradient-to-r from-emerald-500 to-teal-600 text-white px-5 py-3 rounded-xl font-bold">üì• ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets</button>
          <button id="saveToSheets" class="neon bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-5 py-3 rounded-xl font-bold">üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô Sheets</button>
        </div>
        <p class="text-xs text-gray-600 mt-3">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Apps Script ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
      </div>

      <div id="statusBanner" class="hidden mt-4 p-4 rounded-xl bg-white/80 border-2">
        <p class="font-semibold" id="statusMessage"></p>
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô -->
    <div id="employeeInfo" class="glass rounded-2xl p-6 md:p-8 mb-8 hidden">
      <div class="flex items-center mb-6">
        <div class="p-3 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 mr-3">
          <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
      </div>
      <div class="grid lg:grid-cols-5 gap-4">
        <div class="bg-white/85 rounded-xl p-5 border"><div class="text-sm text-gray-500 mb-1">‡∏ä‡∏∑‡πà‡∏≠</div><div id="infoName" class="text-xl font-bold">-</div></div>
        <div class="bg-white/85 rounded-xl p-5 border"><div class="text-sm text-gray-500 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div><div id="infoType" class="text-xl font-bold">-</div></div>
        <div class="bg-white/85 rounded-xl p-5 border"><div class="text-sm text-gray-500 mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤</div><div id="infoRate" class="text-xl font-bold">-</div></div>
        <div class="bg-white/85 rounded-xl p-5 border"><div class="text-sm text-gray-500 mb-1">‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß/‡∏ß‡∏±‡∏ô</div><div id="infoMeal" class="text-xl font-bold">-</div></div>
        <div class="bg-white/85 rounded-xl p-5 border">
          <div class="text-sm text-gray-500 mb-1">‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å/‡∏ó‡∏¥‡∏õ ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</div>
          <label class="switch">
            <input id="includeAdjToggle" type="checkbox" checked>
            <span class="slider"></span>
          </label>
          <div class="text-xs text-gray-500 mt-2">‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ = ‡∏£‡∏ß‡∏° - ‡∏´‡∏±‡∏Å + ‡∏ó‡∏¥‡∏õ</div>
        </div>
      </div>
    </div>

    <!-- ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô -->
    <div id="calendarSection" class="glass rounded-2xl p-6 md:p-8 mb-8 hidden">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-gradient-to-r from-green-500 to-blue-500 mr-3">
            <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>
          <h2 class="text-2xl font-bold">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>
        </div>

        <div class="flex items-center gap-3">
          <button id="prevMonth" class="neon bg-gradient-to-r from-orange-500 to-rose-500 text-white px-4 py-3 rounded-xl font-bold">‚Üê ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</button>
          <div id="currentMonth" class="text-xl font-extrabold text-white drop-shadow">-</div>
          <button id="nextMonth" class="neon bg-gradient-to-r from-orange-500 to-rose-500 text-white px-4 py-3 rounded-xl font-bold">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
        </div>
      </div>

      <div class="bg-white/85 rounded-xl p-4 mb-4 border flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="legend-dot dot-work"></div><span class="font-semibold">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
          <div class="legend-dot dot-paid ml-6"></div><span class="font-semibold">‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡∏´‡∏±‡∏Å)</span>
          <div class="legend-dot dot-absent ml-6"></div><span class="font-semibold">‡∏Ç‡∏≤‡∏î (‡∏´‡∏±‡∏Å)</span>
          <div class="legend-dot dot-none ml-6"></div><span class="font-semibold">‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-sm font-semibold">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</span>
          <label class="switch">
            <input id="editLockToggle"  type="checkbox" checked>
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div class="bg-white/85 rounded-xl p-4 mb-4 border">
        <div class="grid grid-cols-7 gap-2 mb-3 text-center text-sm font-bold text-gray-600">
          <div class="p-2 rounded">‡∏≠‡∏≤</div><div class="p-2 rounded">‡∏à</div><div class="p-2 rounded">‡∏≠</div>
          <div class="p-2 rounded">‡∏û</div><div class="p-2 rounded">‡∏û‡∏§</div><div class="p-2 rounded">‡∏®</div><div class="p-2 rounded">‡∏™</div>
        </div>
        <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
      </div>

      <div class="bg-white/85 rounded-xl p-3 border text-center text-sm text-gray-600">
        - ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‚Äú‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Äù (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ)<br/>
        - ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ‡πÄ‡∏°‡∏∑‡πà‡∏≠ ‚Äú‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö 2 ‡∏ß‡∏±‡∏ô‚Äù ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà ‚Äú‡∏Ç‡∏≤‡∏î/‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö)
      </div>
    </div>

    <!-- ‡∏™‡∏£‡∏∏‡∏õ -->
    <div id="summarySection" class="glass rounded-2xl p-6 md:p-8 mb-8 hidden">
      <div class="flex items-center mb-6">
        <div class="p-3 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 mr-3">
          <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 3v18h18"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
      </div>

      <div class="grid lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-white/85 rounded-xl p-5 border">
          <div class="text-sm text-gray-500 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)</div>
          <div id="workDays" class="text-4xl font-black text-emerald-600">0 ‡∏ß‡∏±‡∏ô</div>
        </div>
        <div class="bg-white/85 rounded-xl p-5 border">
          <div class="text-sm text-gray-500 mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å (1-15)</div>
          <div id="firstHalfSalary" class="text-3xl font-black text-orange-600">0 ‡∏ö‡∏≤‡∏ó</div>
          <div id="firstHalfDays" class="text-sm font-semibold text-gray-600 mt-1">0 ‡∏ß‡∏±‡∏ô</div>
        </div>
        <div class="bg-white/85 rounded-xl p-5 border">
          <div class="text-sm text-gray-500 mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á (16-‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</div>
          <div id="secondHalfSalary" class="text-3xl font-black text-teal-600">0 ‡∏ö‡∏≤‡∏ó</div>
          <div id="secondHalfDays" class="text-sm font-semibold text-gray-600 mt-1">0 ‡∏ß‡∏±‡∏ô</div>
        </div>
        <div class="bg-white/85 rounded-xl p-5 border">
          <div class="text-sm text-gray-500 mb-1">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
          <div id="totalSalary" class="text-3xl font-extrabold text-indigo-700">0 ‡∏ö‡∏≤‡∏ó</div>
          <div id="adjLine" class="text-xs text-gray-500 mt-1">‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏ñ‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å/‡∏ó‡∏¥‡∏õ): -</div>
        </div>
      </div>

      <div class="grid md:grid-cols-3 gap-3">
        <button id="btnAddDeduction" class="neon bg-gradient-to-r from-red-500 to-rose-600 text-white px-6 py-4 rounded-xl font-bold">‚ûñ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</button>
        <button id="btnAddTip" class="neon bg-gradient-to-r from-amber-500 to-yellow-600 text-white px-6 py-4 rounded-xl font-bold">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏¥‡∏õ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
        <div class="flex gap-3 justify-center">
          <button id="exportIndividualReport" class="neon bg-gradient-to-r from-violet-600 via-purple-600 to-fuchsia-600 text-white px-6 py-4 rounded-xl font-bold">üë§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô (.txt)</button>
          <button id="exportAllReport" class="neon bg-gradient-to-r from-rose-600 via-pink-600 to-fuchsia-600 text-white px-6 py-4 rounded-2xl font-bold">üë• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô (.txt)</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô -->
  <div id="employeeModal" class="modal"><div class="bg-white rounded-2xl p-6 md:p-8 w-full max-w-lg">
    <h3 id="modalTitle" class="text-2xl font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
    <form id="employeeForm" class="space-y-4">
      <div><label class="block text-sm font-semibold mb-1">‡∏ä‡∏∑‡πà‡∏≠</label><input id="empNameInput" type="text" class="w-full p-3 rounded-xl border-2" required/></div>
      <div><label class="block text-sm font-semibold mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
        <select id="empTypeInput" class="w-full p-3 rounded-xl border-2" required>
          <option value="daily">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
          <option value="monthly">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
        </select>
      </div>
      <div><label id="rateLabel" class="block text-sm font-semibold mb-1">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
        <input id="empRateInput" type="number" min="0" class="w-full p-3 rounded-xl border-2" required/>
      </div>
      <div id="mealWrapper">
        <label class="block text-sm font-semibold mb-1">‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
        <input id="empMealInput" type="number" min="0" class="w-full p-3 rounded-xl border-2" value="50"/>
        <p class="text-xs text-gray-500 mt-1">- ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô: ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô ‚Äú‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Äù<br/>- ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô ‚Äú‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Äù (‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏ß‡∏±‡∏ô ‚Äú‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ/‡∏Ç‡∏≤‡∏î‚Äù)</p>
      </div>
      <div id="paidLeaveWrapper" class="">
        <label class="inline-flex items-center gap-3">
          <input id="empPaidLeaveInput" type="checkbox" class="w-5 h-5"/>
          <span class="text-sm font-semibold">‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‚Äú‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‚Äù (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</span>
        </label>
        <p class="text-xs text-gray-500 mt-1">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‚Äú‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‚Äù</p>
      </div>
      <div class="flex gap-3 pt-2">
        <button type="submit" class="flex-1 neon bg-gradient-to-r from-emerald-500 to-green-600 text-white px-4 py-3 rounded-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button type="button" id="cancelModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </form>
  </div></div>

  <!-- Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö -->
  <div id="editEmployeeModal" class="modal"><div class="bg-white rounded-2xl p-6 md:p-8 w-full max-w-md">
    <h3 class="text-2xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
    <select id="editEmployeeSelect" class="w-full p-3 rounded-xl border-2 mb-4">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
    </select>
    <div class="flex gap-3">
      <button id="confirmEdit" class="flex-1 neon bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-3 rounded-xl font-bold">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      <button id="deleteEmployee" class="flex-1 neon bg-gradient-to-r from-rose-500 to-red-600 text-white px-4 py-3 rounded-xl font-bold">‡∏•‡∏ö</button>
      <button id="cancelEditModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
  </div></div>

  <!-- Modal ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô -->
  <div id="deductionModal" class="modal"><div class="bg-white rounded-2xl p-6 md:p-8 w-full max-w-md">
    <h3 class="text-2xl font-bold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
    <form id="deductionForm" class="space-y-3">
      <div><label class="block text-sm font-semibold mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input id="deductDate" type="date" class="w-full p-3 rounded-xl border-2" required/></div>
      <div><label class="block text-sm font-semibold mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å (‡∏ö‡∏≤‡∏ó)</label><input id="deductAmount" type="number" min="0" class="w-full p-3 rounded-xl border-2" required/></div>
      <div><label class="block text-sm font-semibold mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label><input id="deductNote" type="text" class="w-full p-3 rounded-xl border-2"/></div>
      <div class="flex gap-3 pt-2">
        <button type="submit" class="flex-1 neon bg-gradient-to-r from-red-500 to-rose-600 text-white px-4 py-3 rounded-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button type="button" id="cancelDeduction" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </form>
  </div></div>

  <!-- Modal ‡∏ó‡∏¥‡∏õ -->
  <div id="tipModal" class="modal"><div class="bg-white rounded-2xl p-6 md:p-8 w-full max-w-md">
    <h3 class="text-2xl font-bold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
    <form id="tipForm" class="space-y-3">
      <div><label class="block text-sm font-semibold mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input id="tipDate" type="date" class="w-full p-3 rounded-xl border-2" required/></div>
      <div><label class="block text-sm font-semibold mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label><input id="tipAmount" type="number" min="0" class="w-full p-3 rounded-xl border-2" required/></div>
      <div><label class="block text-sm font-semibold mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label><input id="tipNote" type="text" class="w-full p-3 rounded-xl border-2"/></div>
      <div class="flex gap-3 pt-2">
        <button type="submit" class="flex-1 neon bg-gradient-to-r from-amber-500 to-yellow-600 text-white px-4 py-3 rounded-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button type="button" id="cancelTip" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </form>
  </div></div>

  <!-- Modal ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° (‡∏ï‡∏≤‡∏£‡∏≤‡∏á + ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å) -->
  <div id="allReportModal" class="modal">
    <div class="bg-white rounded-2xl p-6 md:p-8 w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between mb-4">
        <h3 id="allReportTitle" class="text-2xl font-bold">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° - ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3>
        <div class="flex gap-2">
          <button id="confirmExportAllTxt" class="neon bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white px-4 py-2 rounded-lg font-bold text-sm">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô </button>
          <button id="closeAllReport" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-bold text-sm">‡∏õ‡∏¥‡∏î</button>
        </div>
      </div>
      <div class="overflow-auto flex-1 border rounded-xl bg-white">
        <table class="w-full text-sm">
          <thead class="bg-indigo-600 text-white">
          </thead>
          <tbody id="allReportHeader">
            <tr>
           
          <tbody id="allReportBody"></tbody>
            </tr>
        </table>
      </div>
      <div class="text-xs text-gray-600 mt-3">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
    </div>
  </div>

  <script>
    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    // employees[id] = { name, type:'daily'|'monthly', rate, meal, canPaidLeave }
    // workMap[id][key] = 'work'|'paid'|'absent'  (‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÉ‡∏ä‡πâ 'work' ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
    // deductions[id] = [{date,amount,note}], tips[id] = [{date,amount,note}]
    let employees={}, workMap={}, deductions={}, tips={};
    let currentEmployee=null, currentDate=new Date(), editingEmployee=null, employeeCounter=0, calendarUnlocked=false;

    const thaiMonths=['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

    document.addEventListener('DOMContentLoaded', ()=>{
      //loadFromLocal();
      bindUI();
      refreshEmployeeSelect();
      const url=getScriptUrl();
      if(url){
        console.log('‡∏û‡∏ö Google Apps Script URL - ‡πÄ‡∏£‡∏¥‡πà‡∏° fetch ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...');
        showBanner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...', true);
        setTimeout(() => {
          loadFromGoogleSheets();
        }, 50);
      }else {
        console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö Google Apps Script URL - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á');
        showBanner('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...', true);
      }
     
    });

    // Bind UI
    function bindUI(){
      byId('addEmployeeBtn').addEventListener('click', ()=>{ editingEmployee=null; openEmployeeModal(); });
      byId('editEmployeeBtn').addEventListener('click', ()=>{ populateEditSelect(); showModal('editEmployeeModal'); });
      byId('confirmEdit').addEventListener('click', handleEditOpen);
      byId('deleteEmployee').addEventListener('click', handleDeleteEmployee);
      byId('cancelEditModal').addEventListener('click', ()=> hideModal('editEmployeeModal'));
      byId('cancelModal').addEventListener('click', ()=> hideModal('employeeModal'));

      const typeInput=byId('empTypeInput');
      typeInput.addEventListener('change', ()=>{
        if(typeInput.value==='daily'){ byId('rateLabel').textContent='‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)'; }
        else{ byId('rateLabel').textContent='‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)'; }
      });

      byId('employeeForm').addEventListener('submit', saveEmployeeFromModal);

      byId('employeeSelect').addEventListener('change', e=>{
        currentEmployee = e.target.value || null;
        if(currentEmployee){
          showEmployeeInfo(currentEmployee);
          ensureMonthlyDefaults(currentEmployee);
          renderCalendar(); renderSummary();
          showSection(true);
        }else showSection(false);
      });

      byId('prevMonth').addEventListener('click', ()=>{ currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(); renderSummary(); });
      byId('nextMonth').addEventListener('click', ()=>{ currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(); renderSummary(); });

      byId('editLockToggle').addEventListener('change', e=>{
        calendarUnlocked = e.target.checked;
        showBanner(calendarUnlocked?'‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß':'‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß', true, 1500);
      });
      byId('includeAdjToggle').addEventListener('change', ()=> renderSummary());

      // Google Sheets
      byId('loadFromSheets').addEventListener('click', loadFromGoogleSheets);
      byId('saveToSheets').addEventListener('click', saveToGoogleSheets);

      // ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô .txt
      byId('exportIndividualReport').addEventListener('click', exportIndividualReportTXT);
      byId('exportAllReport').addEventListener('click', buildAndShowAllTable);
      byId('confirmExportAllTxt').addEventListener('click', exportAllReportTXT);
      byId('closeAllReport').addEventListener('click', ()=> hideModal('allReportModal'));

      // ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô/‡∏ó‡∏¥‡∏õ
      byId('btnAddDeduction').addEventListener('click', ()=>{ if(!ensureEmployeeSelected()) return; showModal('deductionModal'); });
      byId('btnAddTip').addEventListener('click', ()=>{ if(!ensureEmployeeSelected()) return; showModal('tipModal'); });
      byId('deductionForm').addEventListener('submit', saveDeduction);
      byId('tipForm').addEventListener('submit', saveTip);
      byId('cancelDeduction').addEventListener('click', ()=> hideModal('deductionModal'));
      byId('cancelTip').addEventListener('click', ()=> hideModal('tipModal'));
    }

    // Helpers
    function byId(id){ return document.getElementById(id); }
    function showSection(show){ ['employeeInfo','calendarSection','summarySection'].forEach(id=> byId(id).classList.toggle('hidden', !show)); }
    function showModal(id){ byId(id).classList.add('show'); }
    function hideModal(id){ byId(id).classList.remove('show'); }
    function showBanner(msg, ok=true, timeout=2500){
      const box=byId('statusBanner'), p=byId('statusMessage');
      box.classList.remove('hidden');
      box.classList.toggle('bg-green-50', ok);
      box.classList.toggle('bg-red-50', !ok);
      p.className = ok?'text-green-800 font-semibold':'text-red-800 font-semibold';
      p.textContent = (ok?'‚úÖ ':'‚ùå ') + msg;
      if(timeout) setTimeout(()=> box.classList.add('hidden'), timeout);
    }
    function ensureEmployeeSelected(){ if(!currentEmployee){ showBanner('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô', false); return false; } return true; }
    function num(n){ return Number(n).toLocaleString('th-TH'); }

    // ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
    function openEmployeeModal(id=null){
      const title=byId('modalTitle'), nameI=byId('empNameInput'), typeI=byId('empTypeInput'), rateI=byId('empRateInput'), mealI=byId('empMealInput'), paidI=byId('empPaidLeaveInput');
      if(id){
        title.textContent='‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
        const emp=employees[id];
        nameI.value=emp.name; typeI.value=emp.type; rateI.value=emp.rate; mealI.value=emp.meal??50; paidI.checked=!!emp.canPaidLeave;
      }else{
        title.textContent='‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
        nameI.value=''; typeI.value='daily'; rateI.value=''; mealI.value=50; paidI.checked=false;
      }
      showModal('employeeModal');
    }
    function saveEmployeeFromModal(e){
      e.preventDefault();
      const name=byId('empNameInput').value.trim();
      const type=byId('empTypeInput').value;
      const rate=Math.max(0, Number(byId('empRateInput').value));
      const meal=Math.max(0, Number(byId('empMealInput').value || 0));
      const canPaidLeave=byId('empPaidLeaveInput').checked;
      if(!name || isNaN(rate)) return;

      if(editingEmployee){
        const id=editingEmployee;
        employees[id]={ name, type, rate, meal, canPaidLeave: type==='monthly'?canPaidLeave:canPaidLeave };
        if(type==='monthly') ensureMonthlyDefaults(id);
      }else{
        employeeCounter++; const id='emp'+employeeCounter;
        employees[id]={ name, type, rate, meal, canPaidLeave: type==='monthly'?canPaidLeave:canPaidLeave };
        if(!workMap[id]) workMap[id]={}; if(!deductions[id]) deductions[id]=[]; if(!tips[id]) tips[id]=[];
        if(type==='monthly') ensureMonthlyDefaults(id);
      }
      saveToGoogleSheets(); refreshEmployeeSelect();
      if(currentEmployee){ showEmployeeInfo(currentEmployee); renderCalendar(); renderSummary(); }
      hideModal('employeeModal');
      saveToGoogleSheets();
    }
    function populateEditSelect(){
      const sel=byId('editEmployeeSelect'); sel.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>';
      Object.keys(employees).forEach(id=>{ const o=document.createElement('option'); o.value=id; o.textContent=employees[id].name; sel.appendChild(o); });
    }
    function handleEditOpen(){
      const id=byId('editEmployeeSelect').value; if(!id) return;
      editingEmployee=id; hideModal('editEmployeeModal'); openEmployeeModal(id);
    }
    function handleDeleteEmployee(){
      const id=byId('editEmployeeSelect').value; if(!id) return;
      if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ?')){
        delete employees[id]; delete workMap[id]; delete deductions[id]; delete tips[id];
        if(currentEmployee===id){ currentEmployee=null; byId('employeeSelect').value=''; showSection(false); }
          refreshEmployeeSelect(); hideModal('editEmployeeModal'); saveToGoogleSheets(); showBanner('‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', true);
      }
    }
    function refreshEmployeeSelect(){
      const sel=byId('employeeSelect'); const curr=sel.value;
      sel.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</option>';
      Object.keys(employees).forEach(id=>{ const opt=document.createElement('option'); opt.value=id; opt.textContent=`üë§ ${employees[id].name}`; sel.appendChild(opt); });
      if(curr && employees[curr]) sel.value=curr;
    }
    function showEmployeeInfo(id){
      const emp=employees[id];
      byId('infoName').textContent=emp.name;
      byId('infoType').textContent=emp.type==='daily'?'‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô':'‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
      byId('infoRate').textContent=emp.type==='daily' ? `${num(emp.rate)} ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô` : `${num(emp.rate)} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏Ñ‡∏¥‡∏î ${num(emp.rate/30)} ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô)`;
      byId('infoMeal').textContent=`${num(emp.meal??0)} ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô`;
    }

    // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô" ‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
    function ensureMonthlyDefaults(empId){
      const emp=employees[empId]; if(!emp || emp.type!=='monthly') return;
      if(!workMap[empId]) workMap[empId]={};
      const y=currentDate.getFullYear(), m=currentDate.getMonth(), days=new Date(y,m+1,0).getDate();
      for(let d=1; d<=days; d++){ const key=`${y}-${m}-${d}`; if(!workMap[empId][key]) workMap[empId][key]='work'; }
    }

    // ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
    function renderCalendar(){
      if(!currentEmployee) return;
      const emp=employees[currentEmployee], y=currentDate.getFullYear(), m=currentDate.getMonth();
      byId('currentMonth').textContent=`${thaiMonths[m]} ${y+543}`;
      if(emp.type==='monthly') ensureMonthlyDefaults(currentEmployee);

      const grid=byId('calendarGrid'); grid.innerHTML='';
      const first=new Date(y,m,1), start=new Date(first); start.setDate(start.getDate()-first.getDay());
      const todayStr=new Date().toDateString();

      for(let i=0;i<42;i++){
        const dt=new Date(start); dt.setDate(start.getDate()+i);
        const inMonth=dt.getMonth()===m, key=`${y}-${m}-${dt.getDate()}`, st=(workMap[currentEmployee]||{})[key]||null;

        const cell=document.createElement('div'); cell.className='calendar-day rounded-xl border p-3 text-center select-none bg-white';
        if(!inMonth){ cell.classList.add('opacity-60','bg-gray-50'); }
        const numDiv=document.createElement('div'); numDiv.className='text-lg font-extrabold'; numDiv.textContent=dt.getDate(); cell.appendChild(numDiv);

        if(inMonth && st){
          const b=document.createElement('div'); b.className='badge mt-2 inline-block';
          if(st==='work'){ b.classList.add('status-work'); b.textContent='‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'; }
          if(st==='paid'){ b.classList.add('status-paid'); b.textContent='‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ'; }
          if(st==='absent'){ b.classList.add('status-absent'); b.textContent='‡∏Ç‡∏≤‡∏î'; }
          cell.appendChild(b);
        }
        if(dt.toDateString()===todayStr) cell.classList.add('today');

        if(inMonth){
          cell.style.cursor='pointer';
          cell.addEventListener('click', ()=>{
            if(!calendarUnlocked){ showBanner('‡πÇ‡∏õ‡∏£‡∏î ‚Äú‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‚Äù ‡∏Å‡πà‡∏≠‡∏ô', false, 1800); return; }
            toggleStatus(emp, key, m);
            renderCalendar(); renderSummary();  saveToGoogleSheets();
          });
        }
        grid.appendChild(cell);
      }
    }

    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö 2 ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà ‡∏Ç‡∏≤‡∏î/‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)
    function toggleStatus(emp, key, monthIndex){
      if(!workMap[currentEmployee]) workMap[currentEmployee]={};
      const current=workMap[currentEmployee][key] || null;

      if(emp.type==='daily'){
        if(current==='work'){ delete workMap[currentEmployee][key]; }
        else{ workMap[currentEmployee][key]='work'; }
        return;
      }

      const y=currentDate.getFullYear();
      const paidCount = countStatusInMonth(currentEmployee,y,monthIndex,'paid');
      const paidFull = paidCount >= 2;
      let next;
      if(!paidFull){
        if(current==='work') next='paid';
        else if(current==='paid') next='absent';
        else if(current==='absent') next='work';
        else next='work';
        if(next==='paid'){
          if(!emp.canPaidLeave){ showBanner('‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ‚Äú‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‚Äù', false); next='work'; }
          else if(paidCount >= 2){ showBanner('‡∏Ñ‡∏£‡∏ö ‚Äú‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‚Äù 2 ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß', false); next='work'; }
        }
      }else{
        if(current==='work') next='absent';
        else if(current==='absent') next='work';
        else if(current==='paid') next='absent'; // ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ ‡∏Å‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô "‡∏Ç‡∏≤‡∏î"
        else next='work';
      }
      workMap[currentEmployee][key]=next;
      saveToGoogleSheets();
    }
    function countStatusInMonth(empId,year,month,status){
      let c=0, days=new Date(year,month+1,0).getDate(), map=workMap[empId]||{};
      for(let d=1; d<=days; d++){ if(map[`${year}-${month}-${d}`]===status) c++; }
      return c;
    }

    // ‡∏™‡∏£‡∏∏‡∏õ (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î 30 ‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏°‡∏≠: 15/15) + ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß
    function renderSummary(){
      if(!currentEmployee) return;
      const emp=employees[currentEmployee], y=currentDate.getFullYear(), m=currentDate.getMonth();
      const daysInMonth=new Date(y,m+1,0).getDate();
      let fw=0, sw=0, fa=0, sa=0, fwWorkOnly=0, swWorkOnly=0; // fw/sw = ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•, fwWorkOnly/swWorkOnly = ‡∏ß‡∏±‡∏ô "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô" ‡∏à‡∏£‡∏¥‡∏á

      const map=workMap[currentEmployee]||{};
      for(let d=1; d<=daysInMonth; d++){
        const st=map[`${y}-${m}-${d}`]||null; const fh=d<=15;
        if(emp.type==='daily'){
          if(st==='work'){ if(fh) fw++; else sw++; }
        }else{
          if(st==='work'||st==='paid'){ if(fh) fw++; else sw++; }
          if(st==='work'){ if(fh) fwWorkOnly++; else swWorkOnly++; }
          if(st==='absent'){ if(fh) fa++; else sa++; }
        }
      }

      let fhMoney=0, shMoney=0, total=0, mealTotal=0;
      if(emp.type==='daily'){
        const meal=Number(emp.meal??50);
        fhMoney = fw*emp.rate + fw*meal;
        shMoney = sw*emp.rate + sw*meal;
        mealTotal = (fw+sw)*meal;
        total = fhMoney + shMoney;
      }else{
        const perDay = emp.rate/30;
        // ‡∏ê‡∏≤‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 15/15 ‡∏´‡∏±‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ "‡∏Ç‡∏≤‡∏î"
        const baseFH = perDay * (15 - fa);
        const baseSH = perDay * (15 - sa);
        // ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
        const mealFH = (emp.meal??0) * fwWorkOnly;
        const mealSH = (emp.meal??0) * swWorkOnly;
        fhMoney = baseFH + mealFH;
        shMoney = baseSH + mealSH;
        mealTotal = mealFH + mealSH;
        total = fhMoney + shMoney;
      }

      // ‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏±‡∏ö (‡∏´‡∏±‡∏Å/‡∏ó‡∏¥‡∏õ)
      const incAdj = byId('includeAdjToggle').checked;
      const dedSum = sumAdj(deductions[currentEmployee], y, m);
      const tipSum = sumAdj(tips[currentEmployee], y, m);
      const net = incAdj ? (total - dedSum + tipSum) : null;

      byId('workDays').textContent = `${(fw+sw)} ‡∏ß‡∏±‡∏ô`;
      byId('firstHalfDays').textContent = `${fw} ‡∏ß‡∏±‡∏ô`;
      byId('secondHalfDays').textContent = `${sw} ‡∏ß‡∏±‡∏ô`;
      byId('firstHalfSalary').textContent = `${num(Math.round(fhMoney))} ‡∏ö‡∏≤‡∏ó`;
      byId('secondHalfSalary').textContent = `${num(Math.round(shMoney))} ‡∏ö‡∏≤‡∏ó`;
      byId('totalSalary').textContent = `${num(Math.round(total))} ‡∏ö‡∏≤‡∏ó`;
      byId('adjLine').textContent = incAdj
        ? `‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${num(Math.round(total - dedSum + tipSum))} ‡∏ö‡∏≤‡∏ó (‡∏´‡∏±‡∏Å ${num(dedSum)} + ‡∏ó‡∏¥‡∏õ ${num(tipSum)})`
        : `‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏ñ‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å/‡∏ó‡∏¥‡∏õ): (${num(Math.round(total))} - ‡∏´‡∏±‡∏Å + ‡∏ó‡∏¥‡∏õ)`;
    }

    function sumAdj(list,y,m){
      let s=0; (list||[]).forEach(it=>{ const dt=new Date(it.date); if(!isNaN(dt) && dt.getFullYear()===y && dt.getMonth()===m) s+=Number(it.amount||0); });
      return s;
    }

    // ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô/‡∏ó‡∏¥‡∏õ
    function saveDeduction(e){
      e.preventDefault(); if(!ensureEmployeeSelected()) return;
      const date=byId('deductDate').value, amount=Number(byId('deductAmount').value||0), note=byId('deductNote').value||'';
      if(!deductions[currentEmployee]) deductions[currentEmployee]=[];
      deductions[currentEmployee].push({date,amount,note});
      hideModal('deductionModal');  saveToGoogleSheets(); renderSummary(); showBanner('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', true); e.target.reset();
    }
    function saveTip(e){
      e.preventDefault(); if(!ensureEmployeeSelected()) return;
      const date=byId('tipDate').value, amount=Number(byId('tipAmount').value||0), note=byId('tipNote').value||'';
      if(!tips[currentEmployee]) tips[currentEmployee]=[];
      tips[currentEmployee].push({date,amount,note});
      hideModal('tipModal');  saveToGoogleSheets(); renderSummary(); showBanner('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', true); e.target.reset();
    }

    // Local storage
    function saveToLocal(){ localStorage.setItem('salary_v23_meal', JSON.stringify({employees, workMap, deductions, tips, employeeCounter})); }
    function loadFromLocal(){
      const raw=localStorage.getItem('salary_v23_meal'); if(!raw) return;
      try{ const d=JSON.parse(raw)||{}; employees=d.employees||{}; workMap=d.workMap||{}; deductions=d.deductions||{}; tips=d.tips||{}; employeeCounter=d.employeeCounter||Object.keys(employees).length; }catch(e){}
    }

    // Google Sheets (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)
    function getScriptUrl(){ return byId('appsScriptUrl').value.trim(); }

    async function loadFromGoogleSheets(){
      const url=getScriptUrl(); 
      if(!url){
         showBanner('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏Å‡πà‡∏≠‡∏ô', false); 
         return; 
      }
      try{
        showBanner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...', true, 10000);
        const listRes=await fetch(`${url}?listEmployees=true`); const list=await listRes.json(); if(list.error) throw new Error(list.error);
        employees={}; workMap={}; deductions={}; tips={}; currentEmployee=null;
        for(const emp of list.employees){
          const res=await fetch(`${url}?empId=${encodeURIComponent(emp.empId)}`); const detail=await res.json(); if(detail.error) continue;
          employees[emp.empId]={ name:detail.name, type:(detail.type==='monthly'?'monthly':'daily'), rate:Number(detail.rate||0), meal:Number(detail.meal||0), canPaidLeave:!!detail.canPaidLeave };
          workMap[emp.empId]={};
          (detail.workDays||[]).forEach(w=>{ const dt=new Date(w.date); if(!isNaN(dt)){ const k=`${dt.getFullYear()}-${dt.getMonth()}-${dt.getDate()}`; if(['work','paid','absent'].includes(w.status)) workMap[emp.empId][k]=w.status; else if(employees[emp.empId].type==='monthly') workMap[emp.empId][k]='work'; } });
          deductions[emp.empId]=detail.deductions||[]; tips[emp.empId]=detail.tips||[];
        }
        refreshEmployeeSelect(); showSection(false); showBanner(`‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${Object.keys(employees).length} ‡∏Ñ‡∏ô)`, true);
      }catch(e){ console.error(e); showBanner('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', false); }
    }
    async function saveToGoogleSheets(){
      const url=getScriptUrl(); 
      if(!url){ 
        showBanner('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏Å‡πà‡∏≠‡∏ô', false); 
        return; }
      try{
        showBanner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô Google Sheets...', true, 10000);
        const empArray=Object.keys(employees).map(id=>({empId:id, ...employees[id]}));
        const y=currentDate.getFullYear(), m=currentDate.getMonth(), days=new Date(y,m+1,0).getDate();
        const workdays=[];
        Object.keys(workMap).forEach(empId=>{
          for(let d=1; d<=days; d++){
            const st=(workMap[empId]||{})[`${y}-${m}-${d}`]; if(!st) continue;
            const date=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            workdays.push({empId,date,status:st});
          }
        });
        const res1=await fetch(url,{method:'POST',headers:{'Content-Type':'text/plain;charset=utf-8'},body:JSON.stringify({action:'saveEmployeesV2',employees:empArray})});
        const r1=JSON.parse((await res1.text())||'{}'); if(r1.error) throw new Error(r1.error);
        const res2=await fetch(url,{method:'POST',headers:{'Content-Type':'text/plain;charset=utf-8'},body:JSON.stringify({action:'saveWorkdaysV2',workdays})});
        const r2=JSON.parse((await res2.text())||'{}'); if(r2.error) throw new Error(r2.error);
        const res3=await fetch(url,{method:'POST',headers:{'Content-Type':'text/plain;charset=utf-8'},body:JSON.stringify({action:'saveAdjustmentsV2',deductions,tips})});
        const r3=JSON.parse((await res3.text())||'{}'); if(r3.error) throw new Error(r3.error);
        showBanner('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', true);
      }catch(e){ console.error(e); showBanner('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô Google Sheets ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', false); }
    }

    // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° .txt)
    function exportIndividualReportTXT(){
      if(!ensureEmployeeSelected()) return;
      const id=currentEmployee; const txt = buildEmployeeReportTXT(id);
      const y=currentDate.getFullYear(), m=currentDate.getMonth();
      downloadText(`‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_${employees[id].name}_${thaiMonths[m]}_${y+543}.txt`, txt);
      showBanner('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô‡πÅ‡∏•‡πâ‡∏ß', true);
    }
function buildAndShowAllTable() {
  const y = currentDate.getFullYear(), m = currentDate.getMonth();
  const body = byId('allReportBody'); 
  body.innerHTML = '';

  let totalFirstHalf = 0, totalSecondHalf = 0, totalMeal = 0, totalDed = 0, totalTip = 0, totalNet = 0, totalDays = 0;
  const rows = [];

  Object.keys(employees).forEach(id => {
    const emp = employees[id]; 
    const map = workMap[id] || {}; 
    const days = new Date(y,m+1,0).getDate();
    let fw=0, sw=0, fa=0, sa=0, fwWorkOnly=0, swWorkOnly=0;

    for(let d=1; d<=days; d++){
      const st=map[`${y}-${m}-${d}`]; const fh=d<=15;
      if(emp.type==='daily'){
        if(st==='work'){ if(fh) fw++; else sw++; }
      } else {
        if(st==='work'||st==='paid'){ if(fh) fw++; else sw++; }
        if(st==='work'){ if(fh) fwWorkOnly++; else swWorkOnly++; }
        if(st==='absent'){ if(fh) fa++; else sa++; }
      }
    }

    let fhM=0, shM=0, total=0, mealTotal=0;
    if(emp.type==='daily'){
      const meal=Number(emp.meal??50);
      fhM=fw*emp.rate + fw*meal; 
      shM=sw*emp.rate + sw*meal; 
      mealTotal=(fw+sw)*meal; 
      total=fhM+shM;
    } else {
      const perDay=emp.rate/30;
      const baseFH=perDay*(15-fa), baseSH=perDay*(15-sa);
      const mealFH=(emp.meal??0)*fwWorkOnly, mealSH=(emp.meal??0)*swWorkOnly;
      fhM=baseFH+mealFH; 
      shM=baseSH+mealSH; 
      mealTotal=mealFH+mealSH; 
      total=fhM+shM;
    }

    const ded=sumAdj(deductions[id], y, m); 
    const tip=sumAdj(tips[id], y, m);
    const net = total - ded + tip;

    totalFirstHalf += fhM;
    totalSecondHalf += shM;
    totalMeal += mealTotal;
    totalDed += ded;
    totalTip += tip;
    totalNet += net;
    totalDays += (fw+sw);

    rows.push(`
      <tr class="hover:bg-yellow-50 transition-colors">
        <td class="border border-gray-300 px-3 py-3 font-semibold text-gray-800 text-sm">${emp.name}</td>
        <td class="border border-gray-300 px-3 py-3 text-gray-700 text-sm">${emp.type==='daily'?'‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô':'‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-blue-600 text-sm">${num(emp.rate)}</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-blue-600 text-sm">${num(mealTotal)}</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-orange-600 text-sm">${fw} ‡∏ß‡∏±‡∏ô</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-orange-600 text-sm">${num(Math.round(fhM))}</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-teal-600 text-sm">${sw} ‡∏ß‡∏±‡∏ô</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-teal-600 text-sm">${num(Math.round(shM))}</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-orange-600 text-sm">-${num(ded)}</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-orange-600 text-sm">+${num(tip)}</td>
        <td class="border border-gray-300 px-3 py-3 text-center font-bold text-purple-600 text-sm">${num(Math.round(net))}</td>
      </tr>
    `);
  });

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
  body.innerHTML = `
    <tr class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
      <th class="border border-gray-300 px-3 py-3 text-left font-bold text-sm">üë§ ‡∏ä‡∏∑‡πà‡∏≠</th>
      <th class="border border-gray-300 px-3 py-3 text-left font-bold text-sm">üíº ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üíµ ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ß‡∏±‡∏ô</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üìä ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üìä ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üìä ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üíé ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üìä ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üíé ‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</th>
      <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üèÜ ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
    </tr>
    ${rows.join('')}
    <tr class="bg-gradient-to-r from-yellow-400 to-orange-400 text-white font-bold">
      <td colspan="3" class="border border-gray-300 px-3 py-4 text-center text-lg">üéØ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">-</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">-</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">${num(Math.round(totalFirstHalf))}</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">-</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">${num(Math.round(totalSecondHalf))}</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">${num(Math.round(totalDed))}</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">${num(Math.round(totalTip))}</td>
      <td class="border border-gray-300 px-3 py-4 text-center text-lg">${num(Math.round(totalNet))}</td>
    </tr>
  `;

  showModal('allReportModal');
}
    function exportAllReportTXT(){
      const y=currentDate.getFullYear(), m=currentDate.getMonth();
      let parts=[`‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° - ${thaiMonths[m]} ${y+543}`, ''];
      Object.keys(employees).forEach(id=>{ parts.push(buildEmployeeReportTXT(id) + `\n‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ` + num(Math.round(calcTotalFor(id) - sumAdj(deductions[id], y, m) + sumAdj(tips[id], y, m))) + ' ‡∏ö‡∏≤‡∏ó'); parts.push(''); });
      const all=parts.join('\n');
      downloadText(`‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°_${thaiMonths[m]}_${y+543}.txt`, all);
      showBanner('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÅ‡∏•‡πâ‡∏ß', true);
    }

    function calcTotalFor(id){
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ô total ‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö summary/export
      const emp=employees[id]; const y=currentDate.getFullYear(), m=currentDate.getMonth();
      const days=new Date(y,m+1,0).getDate(); const map=workMap[id]||{};
      let fw=0, sw=0, fa=0, sa=0, fwWorkOnly=0, swWorkOnly=0;
      for(let d=1; d<=days; d++){
        const st=map[`${y}-${m}-${d}`]; const fh=d<=15;
        if(emp.type==='daily'){
          if(st==='work'){ if(fh) fw++; else sw++; }
        }else{
          if(st==='work'||st==='paid'){ if(fh) fw++; else sw++; }
          if(st==='work'){ if(fh) fwWorkOnly++; else swWorkOnly++; }
          if(st==='absent'){ if(fh) fa++; else sa++; }
        }
      }
      if(emp.type==='daily'){
        const meal=Number(emp.meal??50);
        const fhMoney = fw*emp.rate + fw*meal;
        const shMoney = sw*emp.rate + sw*meal;
        return fhMoney+shMoney;
      }else{
        const perDay=emp.rate/30;
        const baseFH=perDay*(15-fa), baseSH=perDay*(15-sa);
        const mealFH=(emp.meal??0)*fwWorkOnly, mealSH=(emp.meal??0)*swWorkOnly;
        return (baseFH+mealFH) + (baseSH+mealSH);
      }
    }

   function buildEmployeeReportTXT(id){
  const emp=employees[id]; 
  const y=currentDate.getFullYear(), m=currentDate.getMonth();
  const days=new Date(y,m+1,0).getDate(), map=workMap[id]||{};
  let fw=0, sw=0, fa=0, sa=0, fwWorkOnly=0, swWorkOnly=0;
  const workDaysList=[], paidDaysList=[], absentDaysList=[];
  
  for(let d=1; d<=days; d++){
    const st=map[`${y}-${m}-${d}`]; const fh=d<=15;
    if(emp.type==='daily'){
      if(st==='work'){ if(fh) fw++; else sw++; workDaysList.push(d); }
    }else{
      if(st==='work'||st==='paid'){ if(fh) fw++; else sw++; }
      if(st==='work'){ if(fh) fwWorkOnly++; else swWorkOnly++; }
      if(st==='paid') paidDaysList.push(d);
      if(st==='absent'){ if(fh) fa++; else sa++; absentDaysList.push(d); }
    }
  }

  let fhMoney=0, shMoney=0, total=0, mealTotal=0;
  if(emp.type==='daily'){
    const meal=Number(emp.meal??50);
    fhMoney=fw*emp.rate + fw*meal; 
    shMoney=sw*emp.rate + sw*meal; 
    mealTotal=(fw+sw)*meal;
    total=fhMoney+shMoney;
  }else{
    const perDay=emp.rate/30;
    const baseFH=perDay*(15-fa), baseSH=perDay*(15-sa);
    const mealFH=(emp.meal??0)*fwWorkOnly, mealSH=(emp.meal??0)*swWorkOnly;
    fhMoney=baseFH+mealFH; 
    shMoney=baseSH+mealSH; 
    mealTotal=mealFH+mealSH;
    total=fhMoney+shMoney;
  }

  const dedSum=sumAdj(deductions[id], y, m);
  const tipSum=sumAdj(tips[id], y, m);

  const lines=[
    `‡∏ä‡∏∑‡πà‡∏≠: ${emp.name}`,
    `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${emp.type==='daily'?'‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô':'‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}`,
    `‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${thaiMonths[m]} ${y+543}`,
    emp.type==='daily' ? `‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô: ${workDaysList.length?workDaysList.join(', '):'-'}` : `‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô(‡∏ß‡∏±‡∏ô): ${fw+sw} ‡∏ß‡∏±‡∏ô`,
    `‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ: ${emp.type==='monthly'?(paidDaysList.length?paidDaysList.join(', '):'-'):'-'}`,
    `‡∏Ç‡∏≤‡∏î: ${absentDaysList.length?absentDaysList.join(', '):'-'}`,
    emp.type==='daily' ? `‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß (‡∏£‡∏ß‡∏°): ${num(mealTotal)} ‡∏ö‡∏≤‡∏ó` : `‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß (‡∏£‡∏ß‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô): ${num(mealTotal)} ‡∏ö‡∏≤‡∏ó`,
    `‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å (1-15): ${num(Math.round(fhMoney))} ‡∏ö‡∏≤‡∏ó`,
    `‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á (16-‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô): ${num(Math.round(shMoney))} ‡∏ö‡∏≤‡∏ó`,
    `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${num(Math.round(total))} ‡∏ö‡∏≤‡∏ó`,
    `‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°: ${num(dedSum)} ‡∏ö‡∏≤‡∏ó`,
    `‡∏ó‡∏¥‡∏õ‡∏£‡∏ß‡∏°: ${num(tipSum)} ‡∏ö‡∏≤‡∏ó`,
    `‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${num(Math.round(total - dedSum + tipSum))} ‡∏ö‡∏≤‡∏ó`
  ];

  // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á popup preview
  const txtContent = lines.join('\n');
  const modal = document.createElement('div');
  modal.className = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";
  modal.innerHTML = `
    <div class="bg-white rounded-xl shadow-xl w-96 p-6 relative">
      <h3 class="text-lg font-bold mb-4">üìÑ ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô TXT</h3>
      <pre class="bg-gray-100 rounded-lg p-3 text-sm overflow-auto max-h-80">${txtContent}</pre>
      <div class="flex justify-end gap-2 mt-4">
        <button id="cancelPreview" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">‡∏õ‡∏¥‡∏î</button>
        <button id="downloadTxt" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå TXT</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);

  // ‡∏õ‡∏¥‡∏î modal
  modal.querySelector('#cancelPreview').onclick = () => modal.remove();

  // ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
  modal.querySelector('#downloadTxt').onclick = () => {
    const blob = new Blob([txtContent], { type: "text/plain;charset=utf-8" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `Report_${emp.name}_${thaiMonths[m]}${y+543}.txt`;
    link.click();
    modal.remove();
  };
}

// ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
function downloadText(filename, content){
  const blob=new Blob([content],{type:'text/plain;charset=utf-8'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download=filename; document.body.appendChild(a); a.click();
  document.body.removeChild(a); URL.revokeObjectURL(url);
    }
    
    function showAllReportModal(employeeData, totalWorkDays, totalSalary, totalFirstHalfSalary, totalSecondHalfSalary, month, year) {
  const filename = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°_${thaiMonths[month]}_${year + 543}`;

  // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Modal
  const modal = document.createElement('div');
  modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
  modal.innerHTML = `
    <div class="bg-white rounded-2xl p-8 max-w-7xl w-full mx-4 shadow-2xl max-h-[95vh] overflow-hidden flex flex-col">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-3xl font-bold gradient-text">üìä ${filename}</h3>
        <button id="closeReportModal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">√ó</button>
      </div>

      <div class="flex-1 overflow-auto space-y-8">

        <!-- üîπ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl shadow-lg">
          <h4 class="text-xl font-bold mb-4">üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°</h4>
          <table class="w-full border-collapse bg-white rounded-xl shadow overflow-hidden">
            <thead>
              <tr class="bg-indigo-600 text-white">
                <th class="px-3 py-2">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                <th class="px-3 py-2">‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å</th>
                <th class="px-3 py-2">‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á</th>
                <th class="px-3 py-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°</th>
                <th class="px-3 py-2">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
              </tr>
            </thead>
            <tbody>
              <tr class="text-center font-bold">
                <td class="px-3 py-2">${thaiMonths[month]} ${year + 543}</td>
                <td class="px-3 py-2 text-orange-600">${totalFirstHalfSalary.toLocaleString()} ‡∏ø</td>
                <td class="px-3 py-2 text-teal-600">${totalSecondHalfSalary.toLocaleString()} ‡∏ø</td>
                <td class="px-3 py-2 text-green-600">${totalWorkDays} ‡∏ß‡∏±‡∏ô</td>
                <td class="px-3 py-2 text-purple-700">${totalSalary.toLocaleString()} ‡∏ø</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- üîπ ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô -->
        <div>
          <h4 class="text-xl font-bold mb-4">üë• ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</h4>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${employeeData.map(emp => `
              <div class="bg-white shadow-xl rounded-xl p-6 hover:shadow-2xl transition">
                <h4 class="text-lg font-bold text-gray-800 mb-2">üë§ ${emp.name}</h4>
                <p class="text-sm text-gray-500 mb-4">${emp.position}</p>
                <div class="space-y-1 text-sm">
                  <p>üìä ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å: <span class="text-orange-600 font-bold">${emp.firstHalfSalary.toLocaleString()} ‡∏ø (${emp.firstHalfDays} ‡∏ß‡∏±‡∏ô)</span></p>
                  <p>üíé ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á: <span class="text-teal-600 font-bold">${emp.secondHalfSalary.toLocaleString()} ‡∏ø (${emp.secondHalfDays} ‡∏ß‡∏±‡∏ô)</span></p>
                  <p>üçö ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß: <span class="text-blue-600 font-bold">${(emp.mealTotal||0).toLocaleString()} ‡∏ø</span></p>
                  <p>‚ûñ ‡∏´‡∏±‡∏Å: <span class="text-red-600 font-bold">-${(emp.deductions||0).toLocaleString()} ‡∏ø</span></p>
                  <p>‚ûï ‡∏ó‡∏¥‡∏õ: <span class="text-green-600 font-bold">+${(emp.tips||0).toLocaleString()} ‡∏ø</span></p>
                  <hr class="my-2"/>
                  <p>üèÜ ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <span class="text-purple-700 font-extrabold">${emp.netSalary.toLocaleString()} ‡∏ø</span></p>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>

      <!-- ‡∏õ‡∏∏‡πà‡∏° -->
      <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mt-6">
        <button id="downloadAllReport" class="flex-1 neon-button bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 hover:from-blue-600 hover:via-indigo-600 hover:to-purple-600 text-white py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
          üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (.txt)
        </button>
        <button id="closeModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-4 rounded-xl font-semibold transition-all">
          ‡∏õ‡∏¥‡∏î
        </button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);

  // ‡∏õ‡∏¥‡∏î modal
  modal.querySelector('#closeReportModal').addEventListener('click', () => document.body.removeChild(modal));
  modal.querySelector('#closeModal').addEventListener('click', () => document.body.removeChild(modal));

  // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å .txt
  modal.querySelector('#downloadAllReport').addEventListener('click', () => {
    let detailedReport = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\n‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${thaiMonths[month]} ${year + 543}\n`;
    detailedReport += `‡∏ß‡∏±‡∏ô‡∏£‡∏ß‡∏°: ${totalWorkDays} ‡∏ß‡∏±‡∏ô | ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å: ${totalFirstHalfSalary.toLocaleString()} ‡∏ø | ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á: ${totalSecondHalfSalary.toLocaleString()} ‡∏ø | ‡∏£‡∏ß‡∏°: ${totalSalary.toLocaleString()} ‡∏ø\n\n`;
    employeeData.forEach((emp,i) => {
      detailedReport += `${i+1}. ${emp.name} (${emp.position})\n`;
      detailedReport += `   ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å: ${emp.firstHalfDays} ‡∏ß‡∏±‡∏ô = ${emp.firstHalfSalary.toLocaleString()} ‡∏ø\n`;
      detailedReport += `   ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á: ${emp.secondHalfDays} ‡∏ß‡∏±‡∏ô = ${emp.secondHalfSalary.toLocaleString()} ‡∏ø\n`;
      detailedReport += `   ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß: ${(emp.mealTotal||0).toLocaleString()} ‡∏ø | ‡∏´‡∏±‡∏Å: -${(emp.deductions||0).toLocaleString()} ‡∏ø | ‡∏ó‡∏¥‡∏õ: +${(emp.tips||0).toLocaleString()} ‡∏ø\n`;
      detailedReport += `   ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${emp.netSalary.toLocaleString()} ‡∏ø\n\n`;
    });
    downloadText(`‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î_${thaiMonths[month]}_${year+543}.txt`, detailedReport);
  });

  // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å modal
  modal.addEventListener('click', e => { if(e.target===modal) document.body.removeChild(modal); });
}
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96fa6cb9014e4b59',t:'MTc1NTI3OTA3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
