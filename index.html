<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Sarabun', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .work-day { 
            background: linear-gradient(135deg, #ff6b6b, #ee5a24) !important; 
            color: white; 
            border: 2px solid #ee5a24 !important; 
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(238, 90, 36, 0.4);
            animation: workDayGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes workDayGlow {
            from { box-shadow: 0 8px 25px rgba(238, 90, 36, 0.4); }
            to { box-shadow: 0 8px 35px rgba(255, 107, 107, 0.6); }
        }
        
        .today { 
            border: 3px solid #ff3838; 
            box-shadow: 0 0 30px rgba(255, 56, 56, 0.8);
            animation: todayPulse 2s infinite;
        }
        
        @keyframes todayPulse {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(255, 56, 56, 0.8);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 56, 56, 1);
                transform: scale(1.02);
            }
        }
        
        .calendar-day:hover { 
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 25px rgba(252, 182, 159, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 200%;
            animation: textGradient 3s ease infinite;
        }
        
        @keyframes textGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .neon-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .neon-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .neon-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .neon-button:hover::before {
            left: 100%;
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .rainbow-border {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3);
            background-size: 400% 400%;
            animation: rainbowBorder 4s ease infinite;
            padding: 3px;
            border-radius: 1rem;
        }
        
        @keyframes rainbowBorder {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .sparkle {
            position: relative;
            overflow: hidden;
        }
        
        .sparkle::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: sparkleMove 10s linear infinite;
            pointer-events: none;
        }
        
        @keyframes sparkleMove {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold gradient-text mb-4">üíº ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h1>
            <p class="text-xl text-gray-600 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</p>
        </div>
        
        <!-- Data Storage Options -->
        <div class="glass-effect rounded-2xl shadow-xl p-8 mb-8 card-hover">
            <div class="flex items-center mb-6">
                <div class="bg-gradient-to-r from-green-400 to-blue-500 p-3 rounded-full mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">üíæ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            </div>
            
            <!-- Storage Method Selection -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-3">üîß ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                  
                    <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-green-50 hover:border-green-300 transition-all">
                        <input type="radio" name="storageMethod" value="googleSheets" class="mr-3" check >
                        <div>
                            <div class="font-bold text-green-600">üìä Google Sheets</div>
                            <div class="text-xs text-gray-500">‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
                        </div>
                    </label>
                    <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-all">
                        <input type="radio" name="storageMethod" value="jsonFile" class="mr-3">
                        <div>
                            <div class="font-bold text-purple-600">üìÑ JSON File</div>
                            <div class="text-xs text-gray-500">‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                        </div>
                    </label>
                    <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-orange-50 hover:border-orange-300 transition-all">
                        <input type="radio" name="storageMethod" value="csvFile" class="mr-3">
                        <div>
                            <div class="font-bold text-orange-600">üìã CSV File</div>
                            <div class="text-xs text-gray-500">‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Google Sheets Section -->
            <div id="googleSheetsSection" class="hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üåê ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
            
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">üîó Google Apps Script Web App URL</label>
                <input type="text" id="appsScriptUrl" value="https://script.google.com/macros/s/AKfycbz8xpaVLZGGlaWikhckQSACparpISNm2iTNAHpgAlfas8lBqqKqGFvj58iFjRHUqa525w/exec" placeholder="‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
             
            </div>
            
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="loadFromSheets" class="neon-button bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">üì•</span>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets
                    </button>
                    <button id="saveToSheets" class="neon-button bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 hover:from-blue-600 hover:via-indigo-600 hover:to-purple-600 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">üì§</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets
                    </button>
                </div>
            </div>

            <!-- Local Storage Section -->
            <div id="localStorageSection">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üíª Local Storage (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå)</h3>
                <div class="flex flex-col sm:flex-row gap-4 mb-4">
                    <button id="saveToLocal" class="neon-button bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 hover:from-blue-600 hover:via-indigo-600 hover:to-purple-600 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">üíæ</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage
                    </button>
                    <button id="loadFromLocal" class="neon-button bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">üìÇ</span>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Local Storage
                    </button>
                    <button id="clearLocal" class="neon-button bg-gradient-to-r from-red-500 via-pink-500 to-red-600 hover:from-red-600 hover:via-pink-600 hover:to-red-700 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">üóëÔ∏è</span>‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Local Storage
                    </button>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-400">
                    <p class="text-blue-800 text-sm">
                        <strong>üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡∏≤‡∏Å‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
                    </p>
                </div>
            </div>

            <!-- File Management Section -->
            <div id="fileManagementSection" class="hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üìÅ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                
                <!-- File Upload -->
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                    <input type="file" id="fileInput" accept=".json,.csv" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                    <p class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .json ‡πÅ‡∏•‡∏∞ .csv</p>
                </div>
                
                <!-- File Download -->
                <div class="flex flex-col sm:flex-row gap-4 mb-4">
                    <button id="downloadJSON" class="neon-button bg-gradient-to-r from-purple-500 via-indigo-500 to-blue-500 hover:from-purple-600 hover:via-indigo-600 hover:to-blue-600 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">üìÑ</span>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î JSON
                    </button>
                    <button id="downloadCSV" class="neon-button bg-gradient-to-r from-orange-500 via-red-500 to-pink-500 hover:from-orange-600 hover:via-red-600 hover:to-pink-600 text-white px-8 py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">üìã</span>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV
                    </button>
                </div>
                
                <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-purple-400">
                    <p class="text-purple-800 text-sm">
                        <strong>üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡πÑ‡∏ü‡∏•‡πå JSON ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏™‡πà‡∏ß‡∏ô CSV ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel ‡∏´‡∏£‡∏∑‡∏≠ Google Sheets
                    </p>
                </div>
            </div>
            
            <div id="connectionStatus" class="mt-4 p-4 rounded-lg ">
                <p id="statusMessage" class="font-semibold"></p>
            </div>


        <!-- Employee Management -->
        <div class="glass-effect rounded-2xl shadow-xl p-8 mb-8 card-hover">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 space-y-4 lg:space-y-0">
                <div class="flex items-center">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 p-3 rounded-full mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
                </div>
                <div class="flex space-x-3">
                    <button id="addEmployeeBtn" class="neon-button bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 hover:from-pink-600 hover:via-purple-600 hover:to-indigo-600 text-white px-6 py-3 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">‚ûï</span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                    </button>
                    <button id="editEmployeeBtn" class="neon-button bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500 hover:from-cyan-600 hover:via-blue-600 hover:to-purple-600 text-white px-6 py-3 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                        <span class="mr-2">‚úèÔ∏è</span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>
            <select id="employeeSelect" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-yellow-200 focus:border-yellow-400 transition-all duration-300 text-lg font-medium bg-white shadow-inner">
                <option value="">üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
            </select>
        </div>

        <!-- Employee Info -->
        <div id="employeeInfo" class="glass-effect rounded-2xl shadow-xl p-8 mb-8 hidden card-hover">
            <div class="flex items-center mb-6">
                <div class="bg-gradient-to-r from-blue-400 to-purple-500 p-3 rounded-full mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="rainbow-border">
                    <div class="bg-gradient-to-br from-pink-100 via-purple-100 to-indigo-100 p-6 rounded-xl shadow-2xl card-hover sparkle">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl mr-3 floating">üë§</span>
                            <h3 class="font-bold text-purple-800 text-lg">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</h3>
                        </div>
                        <p id="empName" class="text-xl font-bold text-purple-900">-</p>
                    </div>
                </div>
                <div class="rainbow-border">
                    <div class="bg-gradient-to-br from-cyan-100 via-blue-100 to-purple-100 p-6 rounded-xl shadow-2xl card-hover sparkle">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl mr-3 floating">üíº</span>
                            <h3 class="font-bold text-blue-800 text-lg">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</h3>
                        </div>
                        <p id="empPosition" class="text-xl font-bold text-blue-900">-</p>
                    </div>
                </div>
                <div class="rainbow-border">
                    <div class="bg-gradient-to-br from-emerald-100 via-teal-100 to-cyan-100 p-6 rounded-xl shadow-2xl card-hover sparkle">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl mr-3 floating">üí∞</span>
                            <h3 class="font-bold text-teal-800 text-lg">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</h3>
                        </div>
                        <p id="empSalary" class="text-xl font-bold text-teal-900">-</p>
                    </div>
                </div>
            </div>


        </div>

        <!-- Calendar -->
        <div id="calendarSection" class="glass-effect rounded-2xl shadow-xl p-8 mb-8 hidden card-hover">
            <div class="flex flex-col lg:flex-row justify-between items-center mb-8 space-y-4 lg:space-y-0">
                <div class="flex items-center">
                    <div class="bg-gradient-to-r from-green-400 to-blue-500 p-3 rounded-full mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>
                </div>
                <div class="flex items-center space-x-4 bg-white bg-opacity-20 backdrop-blur-lg rounded-2xl p-3 shadow-2xl border border-white border-opacity-30">
                    <button id="prevMonth" class="neon-button bg-gradient-to-r from-orange-500 via-pink-500 to-red-500 hover:from-orange-600 hover:via-pink-600 hover:to-red-600 text-white px-8 py-4 rounded-2xl transition-all duration-300 font-bold shadow-2xl hover:shadow-3xl transform hover:scale-105">
                        ‚Üê ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                    </button>
                    <h3 id="currentMonth" class="text-2xl font-bold text-white min-w-[200px] text-center px-4 drop-shadow-lg"></h3>
                    <button id="nextMonth" class="neon-button bg-gradient-to-r from-orange-500 via-pink-500 to-red-500 hover:from-orange-600 hover:via-pink-600 hover:to-red-600 text-white px-8 py-4 rounded-2xl transition-all duration-300 font-bold shadow-2xl hover:shadow-3xl transform hover:scale-105">
                        ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                    </button>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-4 shadow-inner mb-6">
                <div class="grid grid-cols-7 gap-2 mb-4">
                    <div class="text-center font-bold text-gray-700 p-3 bg-gradient-to-r from-red-100 to-red-200 rounded-lg">‡∏≠‡∏≤</div>
                    <div class="text-center font-bold text-gray-700 p-3 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg">‡∏à</div>
                    <div class="text-center font-bold text-gray-700 p-3 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg">‡∏≠</div>
                    <div class="text-center font-bold text-gray-700 p-3 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg">‡∏û</div>
                    <div class="text-center font-bold text-gray-700 p-3 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg">‡∏û‡∏§</div>
                    <div class="text-center font-bold text-gray-700 p-3 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg">‡∏®</div>
                    <div class="text-center font-bold text-gray-700 p-3 bg-gradient-to-r from-red-100 to-red-200 rounded-lg">‡∏™</div>
                </div>
                
                <div id="calendarGrid" class="grid grid-cols-7 gap-3"></div>
            </div>
            
            <div class="bg-white rounded-xl p-4 shadow-inner space-y-4">
                <div class="flex items-center justify-center">
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" id="editModeToggle" class="w-5 h-5 text-yellow-600 bg-gray-100 border-gray-300 rounded focus:ring-yellow-500 focus:ring-2">
                        <span class="text-lg font-semibold text-gray-800">üîß ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
                    </label>
                </div>
                <div class="flex flex-wrap items-center justify-center space-x-8">
                    <div class="flex items-center space-x-3">
                        <div class="w-6 h-6 bg-gradient-to-r from-amber-400 to-orange-500 border-2 border-orange-600 rounded-lg shadow-lg"></div>
                        <span class="text-lg text-gray-800 font-semibold">‚úÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-6 h-6 bg-gray-200 border-2 border-gray-300 rounded-lg"></div>
                        <span class="text-lg text-gray-800 font-semibold">‚ùå ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-6 h-6 bg-red-200 border-2 border-red-400 rounded-lg animate-pulse"></div>
                        <span class="text-lg text-gray-800 font-semibold">üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                    </div>
                </div>
            </div>


        </div>

        <!-- Summary -->
        <div id="summarySection" class="glass-effect rounded-2xl shadow-xl p-8 mb-8 hidden card-hover">
            <div class="flex items-center mb-8">
                <div class="bg-gradient-to-r from-purple-400 to-pink-500 p-3 rounded-full mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-gray-800">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="rainbow-border">
                    <div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white p-6 rounded-2xl shadow-2xl transform hover:scale-105 transition-all duration-300 sparkle">
                        <div class="flex items-center mb-3">
                            <span class="text-4xl mr-3 floating">üìÖ</span>
                            <h3 class="text-xl font-bold drop-shadow-lg">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
                        </div>
                        <p id="workDays" class="text-5xl font-black mb-3 drop-shadow-2xl">0 ‡∏ß‡∏±‡∏ô</p>
                        <div class="bg-white bg-opacity-30 backdrop-blur-sm rounded-xl p-2 text-center border border-white border-opacity-20">
                            <span class="text-sm font-bold">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
                        </div>
                    </div>
                </div>
                
                <div class="rainbow-border">
                    <div class="bg-gradient-to-br from-orange-600 via-red-600 to-pink-600 text-white p-6 rounded-2xl shadow-2xl transform hover:scale-105 transition-all duration-300 sparkle">
                        <div class="flex items-center mb-3">
                            <span class="text-4xl mr-3 floating">üí∞</span>
                            <h3 class="text-xl font-bold drop-shadow-lg">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å</h3>
                        </div>
                        <p id="firstHalfSalary" class="text-5xl font-black mb-3 drop-shadow-2xl">0 ‡∏ö‡∏≤‡∏ó</p>
                        <div class="bg-white bg-opacity-30 backdrop-blur-sm rounded-xl p-2 text-center border border-white border-opacity-20">
                            <span class="text-sm font-bold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1-15</span>
                        </div>
                        <div class="mt-2 text-center">
                            <span id="firstHalfDays" class="text-lg font-bold">0 ‡∏ß‡∏±‡∏ô</span>
                        </div>
                    </div>
                </div>
                
                <div class="rainbow-border">
                    <div class="bg-gradient-to-br from-emerald-600 via-teal-600 to-cyan-600 text-white p-6 rounded-2xl shadow-2xl transform hover:scale-105 transition-all duration-300 sparkle">
                        <div class="flex items-center mb-3">
                            <span class="text-4xl mr-3 floating">üíé</span>
                            <h3 class="text-xl font-bold drop-shadow-lg">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á</h3>
                        </div>
                        <p id="secondHalfSalary" class="text-5xl font-black mb-3 drop-shadow-2xl">0 ‡∏ö‡∏≤‡∏ó</p>
                        <div class="bg-white bg-opacity-30 backdrop-blur-sm rounded-xl p-2 text-center border border-white border-opacity-20">
                            <span class="text-sm font-bold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16-‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                        </div>
                        <div class="mt-2 text-center">
                            <span id="secondHalfDays" class="text-lg font-bold">0 ‡∏ß‡∏±‡∏ô</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="rainbow-border mb-8">
                <div class="bg-gradient-to-br from-purple-700 via-indigo-700 to-blue-700 text-white p-8 rounded-2xl shadow-2xl transform hover:scale-105 transition-all duration-300 sparkle">
                    <div class="flex items-center justify-center mb-4">
                        <span class="text-6xl mr-4 floating">üèÜ</span>
                        <h3 class="text-3xl font-bold drop-shadow-lg">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                    </div>
                    <p id="totalSalary" class="text-7xl font-black mb-4 drop-shadow-2xl text-center">0 ‡∏ö‡∏≤‡∏ó</p>
                    <div class="bg-white bg-opacity-30 backdrop-blur-sm rounded-xl p-4 text-center border border-white border-opacity-20">
                        <span class="text-xl font-bold">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                </div>
            </div>
            
            <div class="text-center space-y-4">
                <div class="flex flex-col sm:flex-row gap-6 justify-center">
                    <button id="exportIndividualReport" class="neon-button bg-gradient-to-r from-violet-600 via-purple-600 to-fuchsia-600 hover:from-violet-700 hover:via-purple-700 hover:to-fuchsia-700 text-white px-10 py-5 rounded-3xl font-black text-xl transition-all transform hover:scale-110 shadow-2xl border-2 border-white border-opacity-20">
                        <span class="mr-3 text-2xl floating">üë§</span>
                        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô
                    </button>
                    <button id="exportAllReport" class="neon-button bg-gradient-to-r from-rose-600 via-pink-600 to-fuchsia-600 hover:from-rose-700 hover:via-pink-700 hover:to-fuchsia-700 text-white px-10 py-5 rounded-3xl font-black text-xl transition-all transform hover:scale-110 shadow-2xl border-2 border-white border-opacity-20">
                        <span class="mr-3 text-2xl floating">üë•</span>
                        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
                    </button>
                </div>
            </div>


        </div>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h3 id="modalTitle" class="text-2xl font-bold text-gray-800 mb-6">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="employeeForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="empNameInput" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input type="text" id="empPositionInput" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="empSalaryInput" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" required>
                </div>
                <div class="flex space-x-4 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white py-3 rounded-lg font-semibold transition-all">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button type="button" id="cancelModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold transition-all">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Employee Modal -->
    <div id="editEmployeeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h3>
            <select id="editEmployeeSelect" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 mb-4">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
            </select>
            <div class="flex space-x-4">
                <button id="confirmEdit" class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white py-3 rounded-lg font-semibold transition-all">
                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </button>
                <button id="deleteEmployee" class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-3 rounded-lg font-semibold transition-all">
                    ‡∏•‡∏ö
                </button>
                <button id="cancelEditModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold transition-all">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
    </div>

    <script>
        // Employee data
        let employees = {};

        // Current state
        let currentEmployee = null;
        let currentDate = new Date();
        let allWorkDays = {}; // Store work days for all employees
        let editMode = false;
        let editingEmployee = null;
        let employeeCounter = 4;

        // Thai month names
        const thaiMonths = [
            '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
            '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
        ];

        // Initialize empty data
        function initializeEmptyData() {
            employees = {};
            allWorkDays = {};
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeEmptyData();
            updateEmployeeSelect();
            
            // Setup storage method listeners
            setupStorageMethodListeners();
            
            // Load from localStorage by default
            loadFromLocalStorage();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ URL ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÅ‡∏•‡πâ‡∏ß fetch ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            const appsScriptUrl = document.getElementById('appsScriptUrl').value.trim();
            if (appsScriptUrl && !appsScriptUrl.includes('YOUR_SCRIPT_ID')) {
                console.log('‡∏û‡∏ö Google Apps Script URL - ‡πÄ‡∏£‡∏¥‡πà‡∏° fetch ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...');
                setTimeout(() => {
                    loadFromGoogleSheets();
                }, 500);
            } else {
                console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö Google Apps Script URL - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á');
            }
        });

        document.getElementById('employeeSelect').addEventListener('change', function() {
            const empId = this.value;
            if (empId) {
                currentEmployee = empId;
                loadEmployeeData(empId);
            } else {
                hideAllSections();
            }
        });

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        });

        document.getElementById('editModeToggle').addEventListener('change', function() {
            editMode = this.checked;
            updateCalendar();
        });

        // Employee management
        document.getElementById('addEmployeeBtn').addEventListener('click', () => {
            editingEmployee = null;
            document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('empNameInput').value = '';
            document.getElementById('empPositionInput').value = '';
            document.getElementById('empSalaryInput').value = '';
            showModal('employeeModal');
        });

        document.getElementById('editEmployeeBtn').addEventListener('click', () => {
            updateEditEmployeeSelect();
            showModal('editEmployeeModal');
        });

        document.getElementById('confirmEdit').addEventListener('click', () => {
            const empId = document.getElementById('editEmployeeSelect').value;
            if (empId) {
                editingEmployee = empId;
                const emp = employees[empId];
                document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
                document.getElementById('empNameInput').value = emp.name;
                document.getElementById('empPositionInput').value = emp.position;
                document.getElementById('empSalaryInput').value = emp.dailySalary;
                hideModal('editEmployeeModal');
                showModal('employeeModal');
            }
        });

        document.getElementById('deleteEmployee').addEventListener('click', () => {
            const empId = document.getElementById('editEmployeeSelect').value;
            if (empId && confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                delete employees[empId];
                delete allWorkDays[empId];
                updateEmployeeSelect();
                updateEditEmployeeSelect();
                hideModal('editEmployeeModal');
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                autoSave();
                
                if (currentEmployee === empId) {
                    currentEmployee = null;
                    hideAllSections();
                    document.getElementById('employeeSelect').value = '';
                }
            }
        });

        document.getElementById('employeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('empNameInput').value;
            const position = document.getElementById('empPositionInput').value;
            const salary = parseInt(document.getElementById('empSalaryInput').value);

            if (editingEmployee) {
                employees[editingEmployee] = { name, position, dailySalary: salary };
            } else {
                employeeCounter++;
                const newId = 'emp' + employeeCounter;
                employees[newId] = { name, position, dailySalary: salary };
                allWorkDays[newId] = new Set();
            }

            updateEmployeeSelect();
            hideModal('employeeModal');
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            autoSave();
            
            if (currentEmployee === editingEmployee) {
                showEmployeeInfo(currentEmployee);
            }
        });

        // Modal controls
        document.getElementById('cancelModal').addEventListener('click', () => hideModal('employeeModal'));
        document.getElementById('cancelEditModal').addEventListener('click', () => hideModal('editEmployeeModal'));

        // Export reports
        document.getElementById('exportIndividualReport').addEventListener('click', exportIndividualReport);
        document.getElementById('exportAllReport').addEventListener('click', exportAllReport);

        // Storage integration
        document.getElementById('loadFromSheets').addEventListener('click', loadFromGoogleSheets);
        document.getElementById('saveToSheets').addEventListener('click', saveToGoogleSheets);
        document.getElementById('saveToLocal').addEventListener('click', saveToLocalStorage);
        document.getElementById('loadFromLocal').addEventListener('click', loadFromLocalStorage);
        document.getElementById('clearLocal').addEventListener('click', clearLocalStorage);
        document.getElementById('downloadJSON').addEventListener('click', downloadJSONFile);
        document.getElementById('downloadCSV').addEventListener('click', downloadCSVFile);
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠ URL ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
        document.getElementById('appsScriptUrl').addEventListener('input', function() {
            const url = this.value.trim();
            if (url && !url.includes('YOUR_SCRIPT_ID') && url.includes('script.google.com')) {
                console.log('URL ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á - ‡πÄ‡∏£‡∏¥‡πà‡∏° fetch ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà...');
                setTimeout(() => {
                    loadFromGoogleSheets();
                }, 250); // ‡∏£‡∏≠ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡∏°‡∏û‡πå
            }
        });

        // Helper functions
        function initializeAllWorkDays() {
            Object.keys(employees).forEach(empId => {
                if (!allWorkDays[empId]) {
                    allWorkDays[empId] = new Set();
                }
            });
        }

        function generateRandomWorkDaysForEmployee(empId) {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const numWorkDays = Math.floor(Math.random() * 6) + 20;
            const workDaysList = [];
            
            for (let i = 1; i <= daysInMonth; i++) {
                workDaysList.push(i);
            }
            
            for (let i = 0; i < numWorkDays && i < workDaysList.length; i++) {
                const randomIndex = Math.floor(Math.random() * workDaysList.length);
                const day = workDaysList.splice(randomIndex, 1)[0];
                allWorkDays[empId].add(`${year}-${month}-${day}`);
            }
        }

        function updateEmployeeSelect() {
            const select = document.getElementById('employeeSelect');
            const currentValue = select.value;
            select.innerHTML = '<option value="">üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>';
            
            // Load from local data
            Object.keys(employees).forEach(empId => {
                const emp = employees[empId];
                const option = document.createElement('option');
                option.value = empId;
                option.textContent = `üë§ ${emp.name}`;
                select.appendChild(option);
            });
            
            if (currentValue && employees[currentValue]) {
                select.value = currentValue;
            }
        }

        function loadEmployeeList() {
            const appsScriptUrl = document.getElementById('appsScriptUrl').value.trim();
            if (!appsScriptUrl) return;

            fetch(`${appsScriptUrl}?listEmployees=true`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showConnectionStatus(data.error);
                        return;
                    }
                    
                    const select = document.getElementById('employeeSelect');
                    select.innerHTML = '<option value="">üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>';
                    
                    data.employees.forEach(emp => {
                        const option = document.createElement('option');
                        option.value = emp.empId;
                        option.textContent = `üë§ ${emp.name}`;
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading employee list:', error);
                    showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');
                });
        }

        function loadEmployeeData(empId) {
            const appsScriptUrl = document.getElementById('appsScriptUrl').value.trim();
            if (!appsScriptUrl || appsScriptUrl.includes('YOUR_SCRIPT_ID')) {
                // Use local data
                showEmployeeInfo(empId);
                showCalendar();
                showConnectionStatus('‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏û‡∏£‡∏≤‡∏∞ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠server‡πÑ‡∏î‡πâ');
            
                return;
            }

            fetch(`${appsScriptUrl}?empId=${empId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.log('Error from Google Sheets, using local data:', data.error);
                        showEmployeeInfo(empId);
                        showCalendar();
                        return;
                    }

                    // Store employee data
                    employees[empId] = {
                        name: data.name,
                        position: data.position,
                        dailySalary: parseFloat(data.dailySalary)
                    };

                    // Convert work days to our format
                    allWorkDays[empId] = new Set();
                    if (data.workDays && data.workDays.length > 0) {
                        data.workDays.forEach(dateStr => {
                            const date = new Date(dateStr);
                            const dateKey = `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
                            allWorkDays[empId].add(dateKey);
                        });
                    }

                    showEmployeeInfo(empId);
                    showCalendar();
                })
                .catch(error => {
                    console.error('Error loading employee data:', error);
                    // Use local data as fallback
                    showEmployeeInfo(empId);
                    showCalendar();
                    showConnectionStatus('‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏û‡∏£‡∏≤‡∏∞ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠server‡πÑ‡∏î‡πâ');
                });
        }

        function updateEditEmployeeSelect() {
            const select = document.getElementById('editEmployeeSelect');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>';
            
            Object.keys(employees).forEach(empId => {
                const emp = employees[empId];
                const option = document.createElement('option');
                option.value = empId;
                option.textContent = emp.name;
                select.appendChild(option);
            });
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        function showEmployeeInfo(empId) {
            const emp = employees[empId];
            document.getElementById('empName').textContent = emp.name;
            document.getElementById('empPosition').textContent = emp.position;
            document.getElementById('empSalary').textContent = emp.dailySalary.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('employeeInfo').classList.remove('hidden');
        }

        function showCalendar() {
            document.getElementById('calendarSection').classList.remove('hidden');
            document.getElementById('summarySection').classList.remove('hidden');
            updateCalendar();
        }

        function hideAllSections() {
            document.getElementById('employeeInfo').classList.add('hidden');
            document.getElementById('calendarSection').classList.add('hidden');
            document.getElementById('summarySection').classList.add('hidden');
        }

        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                `${thaiMonths[month]} ${year + 543}`;

            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day p-4 text-center border-2 border-gray-200 rounded-xl transition-all duration-300 font-semibold text-lg min-h-[60px] flex flex-col items-center justify-center';
                
                if (cellDate.getMonth() !== month) {
                    dayElement.className += ' text-gray-400 bg-gray-100';
                } else {
                    dayElement.className += ' bg-white hover:bg-yellow-50 hover:border-yellow-300 hover:shadow-lg';
                    if (editMode) {
                        dayElement.className += ' cursor-pointer';
                    }
                }

                const dateKey = `${year}-${month}-${cellDate.getDate()}`;
                if (currentEmployee && allWorkDays[currentEmployee] && allWorkDays[currentEmployee].has(dateKey) && cellDate.getMonth() === month) {
                    dayElement.classList.add('work-day');
                    dayElement.innerHTML = `${cellDate.getDate()}<br><span class="text-xs">‚úì</span>`;
                } else {
                    dayElement.textContent = cellDate.getDate();
                }

                const today = new Date();
                if (cellDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }

                if (editMode) {
                    dayElement.addEventListener('click', () => toggleWorkDay(dateKey, dayElement, cellDate, month));
                }
                
                calendarGrid.appendChild(dayElement);
            }

            updateSummary();
        }

        function toggleWorkDay(dateKey, element, cellDate, currentMonth) {
            if (cellDate.getMonth() !== currentMonth || !currentEmployee) return;

            if (!allWorkDays[currentEmployee]) {
                allWorkDays[currentEmployee] = new Set();
            }

            if (allWorkDays[currentEmployee].has(dateKey)) {
                allWorkDays[currentEmployee].delete(dateKey);
                element.classList.remove('work-day');
                element.textContent = cellDate.getDate();
            } else {
                allWorkDays[currentEmployee].add(dateKey);
                element.classList.add('work-day');
                element.innerHTML = `${cellDate.getDate()}<br><span class="text-xs">‚úì</span>`;
            }
            updateSummary();
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            autoSave();
        }

        function updateSummary() {
            if (!currentEmployee) return;
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            let monthWorkDays = 0;
            let firstHalfDays = 0;
            let secondHalfDays = 0;
            
            if (allWorkDays[currentEmployee]) {
                allWorkDays[currentEmployee].forEach(dateKey => {
                    const [keyYear, keyMonth, keyDay] = dateKey.split('-').map(Number);
                    if (keyYear === year && keyMonth === month) {
                        monthWorkDays++;
                        
                        // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á
                        if (keyDay <= 15) {
                            firstHalfDays++;
                        } else {
                            secondHalfDays++;
                        }
                    }
                });
            }

            const dailySalary = employees[currentEmployee].dailySalary;
            const firstHalfSalary = firstHalfDays * dailySalary;
            const secondHalfSalary = secondHalfDays * dailySalary;
            const totalSalary = monthWorkDays * dailySalary;

            document.getElementById('workDays').textContent = `${monthWorkDays} ‡∏ß‡∏±‡∏ô`;
            document.getElementById('firstHalfDays').textContent = `${firstHalfDays} ‡∏ß‡∏±‡∏ô`;
            document.getElementById('secondHalfDays').textContent = `${secondHalfDays} ‡∏ß‡∏±‡∏ô`;
            document.getElementById('firstHalfSalary').textContent = `${firstHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('secondHalfSalary').textContent = `${secondHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('totalSalary').textContent = `${totalSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
        }

        function exportIndividualReport() {
            if (!currentEmployee) return;

            const emp = employees[currentEmployee];
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            let monthWorkDays = 0;
            let firstHalfDays = 0;
            let secondHalfDays = 0;
            const workDaysList = [];
            const firstHalfList = [];
            const secondHalfList = [];
            
            if (allWorkDays[currentEmployee]) {
                allWorkDays[currentEmployee].forEach(dateKey => {
                    const [keyYear, keyMonth, keyDay] = dateKey.split('-').map(Number);
                    if (keyYear === year && keyMonth === month) {
                        monthWorkDays++;
                        workDaysList.push(keyDay);
                        
                        if (keyDay <= 15) {
                            firstHalfDays++;
                            firstHalfList.push(keyDay);
                        } else {
                            secondHalfDays++;
                            secondHalfList.push(keyDay);
                        }
                    }
                });
            }

            workDaysList.sort((a, b) => a - b);
            firstHalfList.sort((a, b) => a - b);
            secondHalfList.sort((a, b) => a - b);
            
            const firstHalfSalary = firstHalfDays * emp.dailySalary;
            const secondHalfSalary = secondHalfDays * emp.dailySalary;
            const totalSalary = monthWorkDays * emp.dailySalary;

            const report = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
===================
‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${emp.name}
‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${emp.position}
‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${thaiMonths[month]} ${year + 543}
‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô: ${emp.dailySalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó

üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
===============
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${workDaysList.join(', ')}
‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏£‡∏ß‡∏°: ${monthWorkDays} ‡∏ß‡∏±‡∏ô

üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1-15) 
================================
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${firstHalfList.length > 0 ? firstHalfList.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}
‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô: ${firstHalfDays} ‡∏ß‡∏±‡∏ô
‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${firstHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó

üíé ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16-‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
=========================================
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${secondHalfList.length > 0 ? secondHalfList.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}
‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô: ${secondHalfDays} ‡∏ß‡∏±‡∏ô
‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${secondHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó

üèÜ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${totalSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}`;

            downloadReport(report, `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô_${emp.name}_${thaiMonths[month]}_${year + 543}.txt`);
        }

        function exportAllReport() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            let totalAllWorkDays = 0;
            let totalAllSalary = 0;
            let totalFirstHalfSalary = 0;
            let totalSecondHalfSalary = 0;
            let employeeData = [];

            Object.keys(employees).forEach(empId => {
                const emp = employees[empId];
                let monthWorkDays = 0;
                let firstHalfDays = 0;
                let secondHalfDays = 0;
                const workDaysList = [];
                const firstHalfList = [];
                const secondHalfList = [];
                
                if (allWorkDays[empId]) {
                    allWorkDays[empId].forEach(dateKey => {
                        const [keyYear, keyMonth, keyDay] = dateKey.split('-').map(Number);
                        if (keyYear === year && keyMonth === month) {
                            monthWorkDays++;
                            workDaysList.push(keyDay);
                            
                            if (keyDay <= 15) {
                                firstHalfDays++;
                                firstHalfList.push(keyDay);
                            } else {
                                secondHalfDays++;
                                secondHalfList.push(keyDay);
                            }
                        }
                    });
                }

                workDaysList.sort((a, b) => a - b);
                firstHalfList.sort((a, b) => a - b);
                secondHalfList.sort((a, b) => a - b);
                
                const firstHalfSalary = firstHalfDays * emp.dailySalary;
                const secondHalfSalary = secondHalfDays * emp.dailySalary;
                const empSalary = monthWorkDays * emp.dailySalary;
                
                totalAllWorkDays += monthWorkDays;
                totalAllSalary += empSalary;
                totalFirstHalfSalary += firstHalfSalary;
                totalSecondHalfSalary += secondHalfSalary;

                employeeData.push({
                    name: emp.name,
                    position: emp.position,
                    dailySalary: emp.dailySalary,
                    workDays: monthWorkDays,
                    firstHalfDays: firstHalfDays,
                    secondHalfDays: secondHalfDays,
                    workDaysList: workDaysList,
                    firstHalfList: firstHalfList,
                    secondHalfList: secondHalfList,
                    firstHalfSalary: firstHalfSalary,
                    secondHalfSalary: secondHalfSalary,
                    totalSalary: empSalary
                });
            });

            showAllReportModal(employeeData, totalAllWorkDays, totalAllSalary, totalFirstHalfSalary, totalSecondHalfSalary, month, year);
        }

        function downloadReport(content, filename) {
            // Create a text area to copy content
            const textArea = document.createElement('textarea');
            textArea.value = content;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                // Try to copy to clipboard
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Show modal with report content
                showReportModal(content, filename);
            } catch (err) {
                document.body.removeChild(textArea);
                showReportModal(content, filename);
            }
        }

        function showAllReportModal(employeeData, totalWorkDays, totalSalary, totalFirstHalfSalary, totalSecondHalfSalary, month, year) {
            const filename = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°_${thaiMonths[month]}_${year + 543}`;
            
            // Create CSV content for Google Sheets
            let csvContent = `‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô,‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á,‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô,‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å,‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å,‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á,‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á,‡∏ß‡∏±‡∏ô‡∏£‡∏ß‡∏°,‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°\n`;
            
            employeeData.forEach(emp => {
                csvContent += `"${emp.name}","${emp.position}",${emp.dailySalary},${emp.firstHalfDays},${emp.firstHalfSalary},${emp.secondHalfDays},${emp.secondHalfSalary},${emp.workDays},${emp.totalSalary}\n`;
            });
            
            csvContent += `\n‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°,,,,,,,${totalWorkDays},${totalSalary}`;

            // Create modal with table view
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-7xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-hidden flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-3xl font-bold gradient-text">üìä ${filename}</h3>
                        <button id="closeReportModal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">√ó</button>
                    </div>
                    
                    <div class="flex-1 overflow-auto mb-6">
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 text-center">
                                <div class="bg-white rounded-lg p-4 shadow-lg">
                                    <h4 class="text-lg font-bold text-gray-700">üìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
                                    <p class="text-2xl font-black text-blue-600">${thaiMonths[month]} ${year + 543}</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-lg">
                                    <h4 class="text-lg font-bold text-gray-700">üí∞ ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å</h4>
                                    <p class="text-2xl font-black text-orange-600">${totalFirstHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-lg">
                                    <h4 class="text-lg font-bold text-gray-700">üíé ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á</h4>
                                    <p class="text-2xl font-black text-teal-600">${totalSecondHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-lg">
                                    <h4 class="text-lg font-bold text-gray-700">üë• ‡∏ß‡∏±‡∏ô‡∏£‡∏ß‡∏°</h4>
                                    <p class="text-2xl font-black text-green-600">${totalWorkDays} ‡∏ß‡∏±‡∏ô</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-lg">
                                    <h4 class="text-lg font-bold text-gray-700">üèÜ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</h4>
                                    <p class="text-2xl font-black text-purple-600">${totalSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse bg-white rounded-xl shadow-lg overflow-hidden">
                                <thead>
                                    <tr class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                                        <th class="border border-gray-300 px-3 py-3 text-left font-bold text-sm">üë§ ‡∏ä‡∏∑‡πà‡∏≠</th>
                                        <th class="border border-gray-300 px-3 py-3 text-left font-bold text-sm">üíº ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                        <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üíµ ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ß‡∏±‡∏ô</th>
                                        <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üìä ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å</th>
                                        <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å</th>
                                        <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üìä ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á</th>
                                        <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üíé ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á</th>
                                        <th class="border border-gray-300 px-3 py-3 text-center font-bold text-sm">üèÜ ‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${employeeData.map((emp, index) => `
                                        <tr class="${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} hover:bg-yellow-50 transition-colors">
                                            <td class="border border-gray-300 px-3 py-3 font-semibold text-gray-800 text-sm">${emp.name}</td>
                                            <td class="border border-gray-300 px-3 py-3 text-gray-700 text-sm">${emp.position}</td>
                                            <td class="border border-gray-300 px-3 py-3 text-center font-bold text-blue-600 text-sm">${emp.dailySalary.toLocaleString()}</td>
                                            <td class="border border-gray-300 px-3 py-3 text-center font-bold text-orange-600 text-sm">${emp.firstHalfDays} ‡∏ß‡∏±‡∏ô</td>
                                            <td class="border border-gray-300 px-3 py-3 text-center font-bold text-orange-600 text-sm">${emp.firstHalfSalary.toLocaleString()}</td>
                                            <td class="border border-gray-300 px-3 py-3 text-center font-bold text-teal-600 text-sm">${emp.secondHalfDays} ‡∏ß‡∏±‡∏ô</td>
                                            <td class="border border-gray-300 px-3 py-3 text-center font-bold text-teal-600 text-sm">${emp.secondHalfSalary.toLocaleString()}</td>
                                            <td class="border border-gray-300 px-3 py-3 text-center font-bold text-purple-600 text-sm">${emp.totalSalary.toLocaleString()}</td>
                                        </tr>
                                    `).join('')}
                                    <tr class="bg-gradient-to-r from-yellow-400 to-orange-400 text-white font-bold">
                                        <td colspan="3" class="border border-gray-300 px-3 py-4 text-center text-lg">üéØ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
                                        <td class="border border-gray-300 px-3 py-4 text-center text-lg">-</td>
                                        <td class="border border-gray-300 px-3 py-4 text-center text-lg">${totalFirstHalfSalary.toLocaleString()}</td>
                                        <td class="border border-gray-300 px-3 py-4 text-center text-lg">-</td>
                                        <td class="border border-gray-300 px-3 py-4 text-center text-lg">${totalSecondHalfSalary.toLocaleString()}</td>
                                        <td class="border border-gray-300 px-3 py-4 text-center text-lg">${totalSalary.toLocaleString()}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                        <button id="copyCSV" class="flex-1 neon-button bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 hover:from-green-600 hover:via-emerald-600 hover:to-teal-600 text-white py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                            üìä ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google Sheets
                        </button>
                        <button id="downloadAllReport" class="flex-1 neon-button bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 hover:from-blue-600 hover:via-indigo-600 hover:to-purple-600 text-white py-4 rounded-xl font-bold transition-all transform hover:scale-105 shadow-2xl">
                            üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                        <button id="closeModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-4 rounded-xl font-semibold transition-all">
                            ‡∏õ‡∏¥‡∏î
                        </button>
                    </div>
                    
                    <div class="mt-4 p-4 bg-blue-50 rounded-xl border-l-4 border-blue-400">
                        <h4 class="font-bold text-blue-800 mb-2">üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</h4>
                        <ol class="text-sm text-blue-700 space-y-1">
                            <li>1. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google Sheets" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á</li>
                            <li>2. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</li>
                            <li>3. ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Google Sheets ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ</li>
                        </ol>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            modal.querySelector('#closeReportModal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.querySelector('#closeModal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.querySelector('#copyCSV').addEventListener('click', () => {
                const textArea = document.createElement('textarea');
                textArea.value = csvContent;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    // Show success message
                    const button = modal.querySelector('#copyCSV');
                    const originalText = button.innerHTML;
                    button.innerHTML = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!';
                    button.classList.add('bg-green-500');
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.classList.remove('bg-green-500');
                    }, 2000);
                } catch (err) {
                    document.body.removeChild(textArea);
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                }
            });
            
            modal.querySelector('#downloadAllReport').addEventListener('click', () => {
                // Create detailed report for all employees
                let detailedReport = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\n`;
                detailedReport += `‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${thaiMonths[month]} ${year + 543}\n`;
                detailedReport += `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}\n`;
                detailedReport += `${'='.repeat(50)}\n\n`;
                
                // Summary section
                detailedReport += `üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°\n`;
                detailedReport += `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${employeeData.length} ‡∏Ñ‡∏ô\n`;
                detailedReport += `‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°: ${totalWorkDays} ‡∏ß‡∏±‡∏ô\n`;
                detailedReport += `‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å: ${totalFirstHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                detailedReport += `‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á: ${totalSecondHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                detailedReport += `‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n\n`;
                
                // Individual employee details
                detailedReport += `üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô\n`;
                detailedReport += `${'='.repeat(50)}\n\n`;
                
                employeeData.forEach((emp, index) => {
                    detailedReport += `${index + 1}. ${emp.name} (${emp.position})\n`;
                    detailedReport += `   ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô: ${emp.dailySalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                    detailedReport += `   ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${emp.workDaysList.length > 0 ? emp.workDaysList.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}\n`;
                    detailedReport += `   \n`;
                    detailedReport += `   ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÅ‡∏£‡∏Å (1-15): ${emp.firstHalfDays} ‡∏ß‡∏±‡∏ô = ${emp.firstHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                    detailedReport += `   ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${emp.firstHalfList.length > 0 ? emp.firstHalfList.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}\n`;
                    detailedReport += `   \n`;
                    detailedReport += `   ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏•‡∏±‡∏á (16-‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô): ${emp.secondHalfDays} ‡∏ß‡∏±‡∏ô = ${emp.secondHalfSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                    detailedReport += `   ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${emp.secondHalfList.length > 0 ? emp.secondHalfList.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}\n`;
                    detailedReport += `   \n`;
                    detailedReport += `   ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${emp.workDays} ‡∏ß‡∏±‡∏ô = ${emp.totalSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                    detailedReport += `   ${'-'.repeat(40)}\n\n`;
                });
                
                // Copy to clipboard
                const textArea = document.createElement('textarea');
                textArea.value = detailedReport;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    // Show success message
                    const button = modal.querySelector('#downloadAllReport');
                    const originalText = button.innerHTML;
                    button.innerHTML = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!';
                    button.classList.add('bg-green-500');
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.classList.remove('bg-green-500');
                    }, 2000);
                    
                    // Show report in modal
                    showReportModal(detailedReport, `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î_${thaiMonths[month]}_${year + 543}.txt`);
                } catch (err) {
                    document.body.removeChild(textArea);
                    showReportModal(detailedReport, `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î_${thaiMonths[month]}_${year + 543}.txt`);
                }
            });
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        function showReportModal(content, filename) {
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[80vh] overflow-hidden flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">üìã ${filename}</h3>
                        <button id="closeReportModal" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">√ó</button>
                    </div>
                    <div class="flex-1 overflow-auto mb-6">
                        <textarea readonly class="w-full h-full min-h-[400px] p-4 border-2 border-gray-200 rounded-lg bg-gray-50 font-mono text-sm resize-none" id="reportContent">${content}</textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button id="copyReport" class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white py-3 rounded-lg font-semibold transition-all">
                            üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                        </button>
                        <button id="closeModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold transition-all">
                            ‡∏õ‡∏¥‡∏î
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            modal.querySelector('#closeReportModal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.querySelector('#closeModal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.querySelector('#copyReport').addEventListener('click', () => {
                const textarea = modal.querySelector('#reportContent');
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ');
                } catch (err) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏î Ctrl+C ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å');
                }
            });
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // Google Apps Script Functions
        function getGoogleSheetsConfig() {
            return {
                appsScriptUrl: document.getElementById('appsScriptUrl').value.trim()
            };
        }



        function showConnectionStatus(message, isSuccess = false) {
            const statusDiv = document.getElementById('connectionStatus');
            const messageP = document.getElementById('statusMessage');
            
            statusDiv.classList.remove('hidden', 'bg-green-50', 'bg-red-50', 'border-green-400', 'border-red-400');
            messageP.classList.remove('text-green-800', 'text-red-800');
            
            if (isSuccess) {
                statusDiv.classList.add('bg-green-50', 'border-l-4', 'border-green-400');
                messageP.classList.add('text-green-800');
                messageP.innerHTML = `‚úÖ ${message}`;
            } else {
                statusDiv.classList.add('bg-red-50', 'border-l-4', 'border-red-400');
                messageP.classList.add('text-red-800');
                messageP.innerHTML = `‚ùå ${message}`;
            }
        }

        async function loadFromGoogleSheets() {
            const config = getGoogleSheetsConfig();
            
            if (!config.appsScriptUrl || config.appsScriptUrl.includes('YOUR_SCRIPT_ID')) {
                showConnectionStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                updateEmployeeSelect(); // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                return;
            }

            try {
                showConnectionStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...');
                
                // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const employeeListResponse = await fetch(`${config.appsScriptUrl}?listEmployees=true`);
                const employeeListData = await employeeListResponse.json();
                
                if (employeeListData.error) {
                    throw new Error(employeeListData.error);
                }
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
                employees = {};
                allWorkDays = {};
                
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                for (const emp of employeeListData.employees) {
                    const empResponse = await fetch(`${config.appsScriptUrl}?empId=${emp.empId}`);
                    const empData = await empResponse.json();
                    
                    if (!empData.error) {
                        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                        employees[emp.empId] = {
                            name: empData.name,
                            position: empData.position,
                            dailySalary: parseFloat(empData.dailySalary)
                        };
                        
                        // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                        allWorkDays[emp.empId] = new Set();
                        if (empData.workDays && empData.workDays.length > 0) {
                            empData.workDays.forEach(dateStr => {
                                if (dateStr) {
                                    const date = new Date(dateStr);
                                    if (!isNaN(date.getTime())) {
                                        const dateKey = `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
                                        allWorkDays[emp.empId].add(dateKey);
                                    }
                                }
                            });
                        }
                    }
                }
                
                updateEmployeeSelect();
                showConnectionStatus(`‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ${Object.keys(employees).length} ‡∏Ñ‡∏ô`, true);
                
                console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î:', employees);
                console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î:', allWorkDays);
                
            } catch (error) {
                console.error('Load from sheets failed:', error);
                showConnectionStatus(`‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`);
                // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ó‡∏ô
                updateEmployeeSelect();
            }
        }

        async function saveToGoogleSheets() {
            const config = getGoogleSheetsConfig();
            
            if (!config.appsScriptUrl || config.appsScriptUrl.includes('YOUR_SCRIPT_ID')) {
                showConnectionStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            try {
                showConnectionStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets...');
                
                // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                const employeeData = [];
                Object.keys(employees).forEach(empId => {
                    const emp = employees[empId];
                    employeeData.push({
                        empId: empId,
                        name: emp.name,
                        position: emp.position,
                        dailySalary: emp.dailySalary
                    });
                });
                
                // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                const workdayData = [];
                Object.keys(allWorkDays).forEach(empId => {
                    if (allWorkDays[empId]) {
                        allWorkDays[empId].forEach(dateKey => {
                            const [year, month, day] = dateKey.split('-').map(Number);
                            const formattedDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            workdayData.push({
                                empId: empId,
                                date: formattedDate
                            });
                        });
                    }
                });
                
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:', employeeData);
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:', workdayData);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                const empResponse = await fetch(config.appsScriptUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'saveEmployees',
                        employees: employeeData
                    })
                });
                
                let empResult;
                try {
                    const empText = await empResponse.text();
                    console.log('Raw employee response:', empText);
                    empResult = JSON.parse(empText);
                } catch (parseError) {
                    console.error('Failed to parse employee response:', parseError);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');
                }
                
                console.log('‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:', empResult);
                
                if (empResult.error) {
                    throw new Error(`‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${empResult.error}`);
                }
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                const workResponse = await fetch(config.appsScriptUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'saveWorkdays',
                        workdays: workdayData
                    })
                });
                
                let workResult;
                try {
                    const workText = await workResponse.text();
                    console.log('Raw workday response:', workText);
                    workResult = JSON.parse(workText);
                } catch (parseError) {
                    console.error('Failed to parse workday response:', parseError);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');
                }
                
                console.log('‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:', workResult);
                
                if (workResult.error) {
                    throw new Error(`‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${workResult.error}`);
                }
                
                showConnectionStatus(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ${employeeData.length} ‡∏Ñ‡∏ô, ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ${workdayData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, true);
                
            } catch (error) {
                console.error('Save to sheets failed:', error);
                showConnectionStatus(`‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`);
            }
        }

        // Storage Method Management
        function setupStorageMethodListeners() {
            const storageRadios = document.querySelectorAll('input[name="storageMethod"]');
            storageRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    toggleStorageSections(this.value);
                });
            });
            
            // Initialize with default selection
            toggleStorageSections('localStorage');
        }

        function toggleStorageSections(method) {
            const googleSheetsSection = document.getElementById('googleSheetsSection');
            const localStorageSection = document.getElementById('localStorageSection');
            const fileManagementSection = document.getElementById('fileManagementSection');
            
            // Hide all sections
            googleSheetsSection.classList.add('hidden');
            localStorageSection.classList.add('hidden');
            fileManagementSection.classList.add('hidden');
            
            // Show selected section
            switch(method) {
                case 'googleSheets':
                    googleSheetsSection.classList.remove('hidden');
                    break;
                case 'localStorage':
                    localStorageSection.classList.remove('hidden');
                    break;
                case 'jsonFile':
                case 'csvFile':
                    fileManagementSection.classList.remove('hidden');
                    break;
            }
        }

        // Local Storage Functions
        function saveToLocalStorage() {
            try {
                const data = {
                    employees: employees,
                    allWorkDays: {}
                };
                
                // Convert Sets to Arrays for JSON serialization
                Object.keys(allWorkDays).forEach(empId => {
                    data.allWorkDays[empId] = Array.from(allWorkDays[empId]);
                });
                
                localStorage.setItem('salaryCalculatorData', JSON.stringify(data));
                showConnectionStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', true);
                console.log('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage ‡πÑ‡∏î‡πâ');
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('salaryCalculatorData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    employees = data.employees || {};
                    allWorkDays = {};
                    
                    // Convert Arrays back to Sets
                    Object.keys(data.allWorkDays || {}).forEach(empId => {
                        allWorkDays[empId] = new Set(data.allWorkDays[empId]);
                    });
                    
                    updateEmployeeSelect();
                    showConnectionStatus('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Local Storage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', true);
                    console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage');
                    showConnectionStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage');
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Local Storage ‡πÑ‡∏î‡πâ');
            }
        }

        function clearLocalStorage() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Local Storage ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                localStorage.removeItem('salaryCalculatorData');
                employees = {};
                allWorkDays = {};
                updateEmployeeSelect();
                hideAllSections();
                showConnectionStatus('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Local Storage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', true);
                console.log('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• localStorage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
        }

        // File Management Functions
        function downloadJSONFile() {
            try {
                const data = {
                    employees: employees,
                    allWorkDays: {},
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                // Convert Sets to Arrays for JSON serialization
                Object.keys(allWorkDays).forEach(empId => {
                    data.allWorkDays[empId] = Array.from(allWorkDays[empId]);
                });
                
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Create temporary link and click it
                const a = document.createElement('a');
                a.href = url;
                a.download = `salary_data_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showConnectionStatus('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', true);
            } catch (error) {
                console.error('Error downloading JSON:', error);
                showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏î‡πâ');
            }
        }

        function downloadCSVFile() {
            try {
                let csvContent = '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô,‡∏ä‡∏∑‡πà‡∏≠,‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á,‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô\n';
                
                Object.keys(employees).forEach(empId => {
                    const emp = employees[empId];
                    const workDays = allWorkDays[empId] ? Array.from(allWorkDays[empId]).join(';') : '';
                    csvContent += `"${empId}","${emp.name}","${emp.position}",${emp.dailySalary},"${workDays}"\n`;
                });
                
                // Add BOM for proper Thai character display in Excel
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `salary_data_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showConnectionStatus('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', true);
            } catch (error) {
                console.error('Error downloading CSV:', error);
                showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡πÑ‡∏î‡πâ');
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    if (file.name.endsWith('.json')) {
                        loadFromJSON(content);
                    } else if (file.name.endsWith('.csv')) {
                        loadFromCSV(content);
                    }
                } catch (error) {
                    console.error('Error reading file:', error);
                    showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ');
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function loadFromJSON(jsonContent) {
            try {
                const data = JSON.parse(jsonContent);
                
                if (data.employees) {
                    employees = data.employees;
                    allWorkDays = {};
                    
                    // Convert Arrays back to Sets
                    Object.keys(data.allWorkDays || {}).forEach(empId => {
                        allWorkDays[empId] = new Set(data.allWorkDays[empId]);
                    });
                    
                    updateEmployeeSelect();
                    showConnectionStatus('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', true);
                    console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }
            } catch (error) {
                console.error('Error loading JSON:', error);
                showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏î‡πâ');
            }
        }

        function loadFromCSV(csvContent) {
            try {
                const lines = csvContent.split('\n');
                const newEmployees = {};
                const newAllWorkDays = {};
                
                // Skip header row
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // Parse CSV line (handle quoted fields)
                    const fields = parseCSVLine(line);
                    if (fields.length >= 4) {
                        const empId = fields[0];
                        const name = fields[1];
                        const position = fields[2];
                        const dailySalary = parseFloat(fields[3]);
                        const workDaysStr = fields[4] || '';
                        
                        newEmployees[empId] = { name, position, dailySalary };
                        newAllWorkDays[empId] = new Set();
                        
                        if (workDaysStr) {
                            const workDays = workDaysStr.split(';');
                            workDays.forEach(day => {
                                if (day.trim()) {
                                    newAllWorkDays[empId].add(day.trim());
                                }
                            });
                        }
                    }
                }
                
                employees = newEmployees;
                allWorkDays = newAllWorkDays;
                updateEmployeeSelect();
                showConnectionStatus('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', true);
                console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å CSV ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } catch (error) {
                console.error('Error loading CSV:', error);
                showConnectionStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡πÑ‡∏î‡πâ');
            }
        }

        function parseCSVLine(line) {
            const fields = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    fields.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            fields.push(current);
            return fields;
        }

        // Auto-save function (modified to support multiple storage methods)
        function autoSave() {
            const selectedMethod = document.querySelector('input[name="storageMethod"]:checked').value;
            
            switch(selectedMethod) {
                case 'localStorage':
                    saveToLocalStorage();
                    break;
                case 'googleSheets':
                    autoSaveToGoogleSheets();
                    break;
                // File methods don't auto-save
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
        async function autoSaveToGoogleSheets() {
            const config = getGoogleSheetsConfig();
            
            if (!config.appsScriptUrl || config.appsScriptUrl.includes('YOUR_SCRIPT_ID')) {
                console.log('‡πÑ‡∏°‡πà‡∏°‡∏µ Google Apps Script URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á - ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥');
                return; // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ URL
            }

            try {
                console.log('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...');
                
                // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                const employeeData = [];
                Object.keys(employees).forEach(empId => {
                    const emp = employees[empId];
                    employeeData.push({
                        empId: empId,
                        name: emp.name,
                        position: emp.position,
                        dailySalary: emp.dailySalary
                    });
                });
                
                console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:', employeeData);
                
                // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                const workdayData = [];
                Object.keys(allWorkDays).forEach(empId => {
                    if (allWorkDays[empId]) {
                        allWorkDays[empId].forEach(dateKey => {
                            const [year, month, day] = dateKey.split('-').map(Number);
                            const formattedDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            workdayData.push({
                                empId: empId,
                                date: formattedDate
                            });
                        });
                    }
                });
                
                console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:', workdayData);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                const empResponse = await fetch(config.appsScriptUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'saveEmployees',
                        employees: employeeData
                    })
                });
                
                let empResult;
                try {
                    const empText = await empResponse.text();
                    console.log('Raw employee response (auto):', empText);
                    empResult = JSON.parse(empText);
                } catch (parseError) {
                    console.error('Failed to parse employee response (auto):', parseError);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');
                }
                
                console.log('‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:', empResult);
                
                if (empResult.error) {
                    throw new Error(`‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${empResult.error}`);
                }
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                const workResponse = await fetch(config.appsScriptUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'saveWorkdays',
                        workdays: workdayData
                    })
                });
                
                let workResult;
                try {
                    const workText = await workResponse.text();
                    console.log('Raw workday response (auto):', workText);
                    workResult = JSON.parse(workText);
                } catch (parseError) {
                    console.error('Failed to parse workday response (auto):', parseError);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');
                }
                
                console.log('‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:', workResult);
                
                if (workResult.error) {
                    throw new Error(`‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${workResult.error}`);
                }
                
                console.log('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ
                const statusDiv = document.getElementById('connectionStatus');
                const messageP = document.getElementById('statusMessage');
                
                statusDiv.classList.remove('hidden', 'bg-red-50', 'border-red-400');
                statusDiv.classList.add('bg-green-50', 'border-l-4', 'border-green-400');
                messageP.classList.remove('text-red-800');
                messageP.classList.add('text-green-800');
                messageP.innerHTML = `‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${new Date().toLocaleTimeString('th-TH')})`;
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 3000);
                
            } catch (error) {
                console.error('‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ
                const statusDiv = document.getElementById('connectionStatus');
                const messageP = document.getElementById('statusMessage');
                
                statusDiv.classList.remove('hidden', 'bg-green-50', 'border-green-400');
                statusDiv.classList.add('bg-red-50', 'border-l-4', 'border-red-400');
                messageP.classList.remove('text-green-800');
                messageP.classList.add('text-red-800');
                messageP.innerHTML = `‚ùå ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`;
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 5000);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9685c580a003d32f',t:'MTc1NDA1NTg4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
